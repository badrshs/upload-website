if (self.CavalryLogger) { CavalryLogger.start_js(["MOjBh"]); }

__d('ConversationNubTabsUpdateEventController',['Arbiter'],(function a(b,c,d,e,f,g){'use strict';var h='ConversationNub/tabsUpdated',i='ConversationNub/minimizedByUser',j='ConversationNub/maximizedByUser',k=false;function l(p){if(!k)c('Arbiter').inform(h,p);}function m(p){return c('Arbiter').subscribe(h,function(q,r){k=true;p(r);k=false;});}function n(p,q){q&&c('Arbiter').inform(i,{tab:p});p.minimize();l();}function o(p,q){q&&c('Arbiter').inform(j,{tab:p});p.popOut();l();}f.exports={TAB_MINIMIZED_BY_USER_EVENT:i,TAB_MAXIMIZED_BY_USER_EVENT:j,informTabsUpdated:l,subscribeToTabsUpdated:m,minimizeAndInformTabUpdate:n,popOutAndInformTabUpdate:o};}),null);
__d('ConversationNub',['csx','cx','Arbiter','ConversationNubHeader','ConversationNubTabsUpdateEventController','ConversationNubUtils','NotificationUserActions','PinnedConversationNubsConfig','CSS','DOM','EventListener','ConversationNubTabState','SubscriptionsHandler','URI','debounce','guid'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('ConversationNubTabState').getConversationNubTabState,k=c('ConversationNubTabsUpdateEventController').minimizeAndInformTabUpdate,l=c('ConversationNubTabsUpdateEventController').popOutAndInformTabUpdate,m=j(),n=10,o=500,p=100;q.createDefaultState=function(r,s,t,u,v,w){return {tabID:r,permalinkURI:s?new (c('URI'))(s):null,ftID:t,notifAlertID:u,title:v,keepAtBottom:false,isTabRaised:false,isBlinkingUnread:false,badgeCount:0,shouldShowNux:w===true,allSeenNewComments:{},unseenCommentsSinceLastCleared:{},hasFakeInitBadge:false};};function q(r,s,t){this.$ConversationNub1=r;this.$ConversationNub8=s;this.$ConversationNub4=c('guid')();this.$ConversationNub6=null;this.$ConversationNub7=null;this.$ConversationNub5=new (c('SubscriptionsHandler'))();this.$ConversationNub9();this.$ConversationNub10();if(t!=null)m.modifyTabState(this.$ConversationNub8,function(u){if(t){u.hasFakeInitBadge=false;}else{u.hasFakeInitBadge=true;this.$ConversationNub11(1);this.$ConversationNub12(true);}}.bind(this));this.$ConversationNub13();}q.prototype.$ConversationNub13=function(){this.$ConversationNub14();this.$ConversationNub15();c('ConversationNubUtils').informShouldRecheckTabVisibility(this);this.forceReflow();};q.prototype.getPersistentState=function(){return m.getTabState(this.$ConversationNub8);};q.prototype.$ConversationNub9=function(){var r=this.$ConversationNub16();if(r){this.$ConversationNub5.addSubscriptions(c('EventListener').listen(r,'click',this.$ConversationNub17.bind(this)),c('EventListener').listen(r,'mouseenter',this.$ConversationNub18.bind(this)),c('EventListener').listen(r,'mouseleave',this.$ConversationNub19.bind(this)));var s=c('ConversationNubUtils').getCloseButtonElem(r);if(s)c('ConversationNubUtils').addCloseButtonListeners(s,this.$ConversationNub5,this.$ConversationNub20.bind(this));}var t=this.$ConversationNub21();if(t){m.modifyTabState(this.$ConversationNub8,function(u){u.keepAtBottom=true;});this.$ConversationNub5.addSubscriptions(c('EventListener').listen(t,'scroll',c('debounce')(this.$ConversationNub22.bind(this),p)),c('Arbiter').subscribe('reflow',this.$ConversationNub23.bind(this)));}};q.prototype.$ConversationNub10=function(){var r=this.$ConversationNub24();if(!r){this.$ConversationNub2=null;return;}var s=function(){var u=this.getPersistentState();return {permalinkURI:u.permalinkURI,ftID:u.ftID,tabID:u.tabID};}.bind(this),t=new (c('ConversationNubHeader'))(r,s);this.$ConversationNub5.addSubscriptions(t.subscribe('closeButton',this.$ConversationNub20.bind(this)),t.subscribe('showMenu',this.$ConversationNub25.bind(this)),t.subscribe('hideMenu',this.$ConversationNub26.bind(this)),t.subscribe('minimizeButton',this.$ConversationNub27.bind(this,true)),t.subscribe('clickHeader',this.$ConversationNub27.bind(this,true)),t.subscribe('menuPermalinkClick',this.$ConversationNub27.bind(this,false)));this.$ConversationNub2=t;};q.prototype.$ConversationNub24=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubFlyoutTitlebar")[0];};q.prototype.$ConversationNub16=function(){return this.$ConversationNub1&&c('DOM').scry(this.$ConversationNub1,".fbNubButton")[0];};q.prototype.$ConversationNub21=function(){if(!this.$ConversationNub3&&this.$ConversationNub1)this.$ConversationNub3=c('DOM').scry(this.$ConversationNub1,".uiScrollableAreaWrap")[0];return this.$ConversationNub3;};q.prototype.$ConversationNub28=function(){var r=this.$ConversationNub16();if(r)return c('DOM').scry(r,"._37op")[0];return null;};q.prototype.$ConversationNub20=function(){c('ConversationNubUtils').informShouldCloseTab(this.$ConversationNub8,c('ConversationNubUtils').CLOSE_REASON_TAB_X_OUT);};q.prototype.$ConversationNub27=function(r){k(this,r);};q.prototype.$ConversationNub25=function(){this.$ConversationNub1&&c('CSS').addClass(this.$ConversationNub1,"_1uw3");};q.prototype.$ConversationNub26=function(){this.$ConversationNub1&&c('CSS').removeClass(this.$ConversationNub1,"_1uw3");};q.prototype.$ConversationNub17=function(){if(this.getPersistentState().isTabRaised){k(this,true);}else l(this,true);};q.prototype.$ConversationNub18=function(){if(this.getPersistentState().isBlinkingUnread)this.$ConversationNub7=new Date();};q.prototype.$ConversationNub19=function(){var r=this.$ConversationNub7;if(r&&this.getPersistentState().isBlinkingUnread){var s=new Date();if(s-r>=o)this.$ConversationNub12(false);}this.$ConversationNub7=null;};q.prototype.$ConversationNub29=function(){var r=this.$ConversationNub21();if(r){var s=r.scrollHeight;if(s>0&&!this.$ConversationNub30(r))r.scrollTop=s;}};q.prototype.$ConversationNub30=function(r){r=r||this.$ConversationNub21();return !!(r&&r.scrollTop>=r.scrollHeight-r.clientHeight-n);};q.prototype.$ConversationNub22=function(){if(!this.getPersistentState().isTabRaised)return;m.modifyTabState(this.$ConversationNub8,function(r){r.keepAtBottom=this.$ConversationNub30();c('ConversationNubUtils').informShouldRecheckTabVisibility(this);}.bind(this));};q.prototype.$ConversationNub23=function(){var r=this.getPersistentState();if(!r.isTabRaised)return;if(r.keepAtBottom){this.$ConversationNub29();this.$ConversationNub6&&clearTimeout(this.$ConversationNub6);this.$ConversationNub6=setTimeout(function(){if(r.keepAtBottom)this.$ConversationNub29();}.bind(this),100);}};q.prototype.$ConversationNub11=function(r){m.modifyTabState(this.$ConversationNub8,function(s){s.badgeCount=r;this.$ConversationNub14();}.bind(this));};q.prototype.$ConversationNub12=function(r){m.modifyTabState(this.$ConversationNub8,function(s){s.isBlinkingUnread=r;this.$ConversationNub15();}.bind(this));};q.prototype.$ConversationNub14=function(){var r=this.$ConversationNub28();if(!r)return;var s=this.getPersistentState().badgeCount,t=s>0;if(t){c('DOM').setContent(r,s);c('CSS').show(r);}else{c('CSS').hide(r);c('DOM').setContent(r,s);}};q.prototype.$ConversationNub15=function(){if(this.$ConversationNub1){var r=this.getPersistentState().isBlinkingUnread;c('CSS').conditionClass(this.$ConversationNub1,"_53tf",r);}};q.prototype.getRootDOM=function(){return this.$ConversationNub1;};q.prototype.getShouldShowNux=function(){return this.getPersistentState().shouldShowNux;};q.prototype.getTabID=function(){return this.$ConversationNub8;};q.prototype.getNotificationAlertID=function(){return this.getPersistentState().notifAlertID;};q.prototype.getFeedbackTargetID=function(){return this.getPersistentState().ftID;};q.prototype.getPermalinkURI=function(){return this.getPersistentState().permalinkURI;};q.prototype.getTitle=function(){return this.getPersistentState().title;};q.prototype.getBadgeCount=function(){return this.getPersistentState().badgeCount;};q.prototype.getIsRaised=function(){return this.getPersistentState().isTabRaised;};q.prototype.getSessionID=function(){return this.$ConversationNub4;};q.prototype.markCommentsAsSeenWithoutBadging=function(r){m.modifyTabState(this.$ConversationNub8,function(s){r.forEach(function(t){s.allSeenNewComments[t]=true;});});};q.prototype.attemptAddNewCommentsToBadge=function(r){m.modifyTabState(this.$ConversationNub8,function(s){r.forEach(function(v){if(s.allSeenNewComments[v])return;s.allSeenNewComments[v]=true;s.unseenCommentsSinceLastCleared[v]=true;});var t=Object.keys(s.unseenCommentsSinceLastCleared).length;if(s.hasFakeInitBadge)t+=1;var u=s.badgeCount;this.$ConversationNub11(t);this.$ConversationNub12(t>0&&t>u);}.bind(this));};q.prototype.clearBadge=function(){m.clearTabNotifications(this.$ConversationNub8);this.$ConversationNub14();this.$ConversationNub15();if(c('PinnedConversationNubsConfig').sharedNotificationsReadStateEnabled){var r=this.getNotificationAlertID();if(r)c('NotificationUserActions').markNotificationsAsRead([r]);}};q.prototype.popOutAndInformTabUpdate=function(){this.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated();};q.prototype.popOut=function(){m.modifyTabState(this.$ConversationNub8,function(r){if(this.$ConversationNub1)c('CSS').addClass(this.$ConversationNub1,"_5r93");r.isTabRaised=true;this.clearBadge();if(r.keepAtBottom)this.$ConversationNub29();}.bind(this));};q.prototype.minimize=function(){m.modifyTabState(this.$ConversationNub8,function(r){if(this.$ConversationNub1)c('CSS').removeClass(this.$ConversationNub1,"_5r93");r.isTabRaised=false;this.$ConversationNub2&&this.$ConversationNub2.hideMenu();this.clearBadge();}.bind(this));};q.prototype.forceReflow=function(){this.$ConversationNub23();};q.prototype.destroy=function(){this.minimize();this.$ConversationNub5.release();this.$ConversationNub2&&this.$ConversationNub2.destroy();this.$ConversationNub2=null;this.$ConversationNub6&&clearTimeout(this.$ConversationNub6);if(this.$ConversationNub1){c('DOM').remove(this.$ConversationNub1);c('Arbiter').inform('ConversationNub/destroy',{root:this.$ConversationNub1});this.$ConversationNub1=null;}};f.exports=q;}),null);
__d('ConversationNubHeader',['csx','ArbiterMixin','Bootloader','ConversationNubUtils','DOM','Event','EventListener','Keys','SubscriptionsHandler','ifRequired','mixin'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;function k(m,n){return c('EventListener').listen(m,'keydown',function(o){if(c('Event').getKeyCode(o)===c('Keys').RETURN)n(o);});}i=babelHelpers.inherits(l,c('mixin')(c('ArbiterMixin')));j=i&&i.prototype;function l(m,n){j.constructor.call(this);this.$ConversationNubHeader1=m;this.$ConversationNubHeader3=n;this.$ConversationNubHeader4=null;this.$ConversationNubHeader5=false;this.$ConversationNubHeader2=new (c('SubscriptionsHandler'))();this.$ConversationNubHeader6();}l.prototype.$ConversationNubHeader6=function(){var m=this.$ConversationNubHeader1;this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(m,'click',this.$ConversationNubHeader7.bind(this)));var n=c('ConversationNubUtils').getCloseButtonElem(m);if(n)c('ConversationNubUtils').addCloseButtonListeners(n,this.$ConversationNubHeader2,this.$ConversationNubHeader8.bind(this));var o=this.$ConversationNubHeader9();if(o)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(o,'click',this.$ConversationNubHeader10.bind(this)),k(o,this.$ConversationNubHeader10.bind(this)));var p=this.$ConversationNubHeader11();if(p)this.$ConversationNubHeader2.addSubscriptions(c('EventListener').listen(p,'click',this.$ConversationNubHeader12.bind(this)),c('EventListener').listen(p,'mouseover',this.$ConversationNubHeader13.bind(this)),c('EventListener').listen(p,'focus',this.$ConversationNubHeader14.bind(this)),k(p,this.$ConversationNubHeader15.bind(this)));};l.prototype.$ConversationNubHeader11=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._1rf1")[0];};l.prototype.$ConversationNubHeader9=function(){return c('DOM').scry(this.$ConversationNubHeader1,"._4a56")[0];};l.prototype.$ConversationNubHeader16=function(){return c('ConversationNubUtils').getCloseButtonElem(this.$ConversationNubHeader1);};l.prototype.$ConversationNubHeader8=function(){this.inform('closeButton');};l.prototype.$ConversationNubHeader10=function(m){if(m.type==='click')m.kill();this.inform('minimizeButton');};l.prototype.$ConversationNubHeader7=function(){this.inform('clickHeader');};l.prototype.$ConversationNubHeader17=function(){this.inform('showMenu');};l.prototype.$ConversationNubHeader18=function(){this.inform('hideMenu');var m=this.$ConversationNubHeader11();m&&m.blur();};l.prototype.$ConversationNubHeader19=function(){this.inform('menuPermalinkClick');};l.prototype.$ConversationNubHeader20=function(m){if(this.$ConversationNubHeader4)return;var n=this.$ConversationNubHeader11();if(!n)return;if(m)this.$ConversationNubHeader5=true;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubHeaderMenu.react"],function(o,p,q){var r=babelHelpers['extends']({},this.$ConversationNubHeader3(),{onMenuShow:this.$ConversationNubHeader17.bind(this),onMenuHide:this.$ConversationNubHeader18.bind(this),onPermalinkClick:this.$ConversationNubHeader19.bind(this),showOnMount:this.$ConversationNubHeader5});this.$ConversationNubHeader4=p.render(o.createElement(q,r),n);}.bind(this),'ConversationNubHeader');};l.prototype.$ConversationNubHeader12=function(m){m.kill();this.$ConversationNubHeader20(true);};l.prototype.$ConversationNubHeader13=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader14=function(){this.$ConversationNubHeader20(false);};l.prototype.$ConversationNubHeader15=function(){if(this.$ConversationNubHeader4){this.$ConversationNubHeader4.toggle();}else this.$ConversationNubHeader20(true);};l.prototype.hideMenu=function(){this.$ConversationNubHeader4&&this.$ConversationNubHeader4.hide();};l.prototype.destroy=function(){var m=this.$ConversationNubHeader11();if(m&&this.$ConversationNubHeader4)c('ifRequired')('ReactDOM',function(n){n.unmountComponentAtNode(m);});this.$ConversationNubHeader2.release();};f.exports=l;}),null);
__d('PersistedStore',['invariant','WebStorage','areEqual','deepFreezeValue'],(function a(b,c,d,e,f,g,h){'use strict';function i(j){var k=j.initialValue,l=j.storageKeyPrefix,m=j.serializer,n=j.deserializer,o=j.onDataUpdatedOutOfBand,p=j.enablePersistence,q=p===undefined?true:p;this.$PersistedStore2=null;this.$PersistedStore3=null;this.$PersistedStore5=0;if(q)this.$PersistedStore7=c('WebStorage').getLocalStorage();this.$PersistedStore1=k;this.$PersistedStore4=l;this.$PersistedStore6=l+'.PersistedStoreMetadata';this.$PersistedStore8=m;this.$PersistedStore9=n;this.$PersistedStore10=o;this.reloadFromStorageIfNecessary();}i.prototype.$PersistedStore11=function(j){var k=JSON.stringify(this.$PersistedStore8(j));return this.$PersistedStore9(JSON.parse(k));};i.prototype.$PersistedStore12=function(){return this.$PersistedStore11(this.$PersistedStore1);};i.prototype.isPersisted=function(){return this.$PersistedStore7!=null;};i.prototype.modify=function(j){this.$PersistedStore3=null;if(!this.isPersisted()){this.$PersistedStore1=j(this.$PersistedStore1);}else if(this.$PersistedStore2){this.$PersistedStore2=j(this.$PersistedStore2);}else{var k=void 0;try{this.$PersistedStore2=this.$PersistedStore12();k=j(this.$PersistedStore2);}finally{this.$PersistedStore2=null;}if(k&&!c('areEqual')(this.$PersistedStore1,k)){this.$PersistedStore1=k;this.$PersistedStore13();}}};i.prototype.getData=function(){if(!this.isPersisted()){return this.$PersistedStore1;}else if(this.$PersistedStore3)return this.$PersistedStore3;var j=void 0;if(this.$PersistedStore2){j=this.$PersistedStore11(this.$PersistedStore2);c('deepFreezeValue')(j);}else{j=this.$PersistedStore12();c('deepFreezeValue')(j);this.$PersistedStore3=j;}return j;};i.prototype.$PersistedStore14=function(j){if(this.$PersistedStore7!=null)if(j>i.VERSION){this.$PersistedStore7=null;}else if(j<i.VERSION){this.$PersistedStore7.removeItem(this.$PersistedStore6);this.$PersistedStore7.removeItem(this.$PersistedStore4);}else return true;return false;};i.prototype.$PersistedStore15=function(){try{if(this.$PersistedStore7!=null){var k=this.$PersistedStore7.getItem(this.$PersistedStore6);if(k!=null){var l=JSON.parse(k),m=Number.parseInt(l.highWaterMark,10),n=Number.parseInt(l.version,10);if(m&&n)return {highWaterMark:m,version:n};}}}catch(j){this.$PersistedStore7=null;}return null;};i.prototype.reloadFromStorageIfNecessary=function(){if(!this.isPersisted())return;var j=this.$PersistedStore15();if(j){var k=j.highWaterMark,l=j.version;if(this.$PersistedStore14(l)&&this.$PersistedStore5<k)this.$PersistedStore16(k);}};i.prototype.$PersistedStore16=function(j){var k=this.$PersistedStore17();if(k)this.$PersistedStore18(k,j);};i.prototype.$PersistedStore17=function(){var j=null;try{if(this.$PersistedStore7){var l=this.$PersistedStore7.getItem(this.$PersistedStore4);if(l!=null)j=JSON.parse(l);}}catch(k){this.$PersistedStore7=null;}return j;};i.prototype.$PersistedStore18=function(j,k){this.$PersistedStore3=null;var l=this.$PersistedStore9(j),m=this.$PersistedStore1;this.$PersistedStore1=l;this.$PersistedStore5=k;this.$PersistedStore10(m,l);};i.prototype.$PersistedStore13=function(){this.reloadFromStorageIfNecessary();if(!this.isPersisted())return;var j=this.$PersistedStore8(this.$PersistedStore1),k=JSON.stringify(j),l={highWaterMark:++this.$PersistedStore5,version:i.VERSION},m=JSON.stringify(l);try{this.$PersistedStore7!=null||h(0);this.$PersistedStore7.setItem(this.$PersistedStore6,m);this.$PersistedStore7.setItem(this.$PersistedStore4,k);}catch(n){this.$PersistedStore7=null;}};i.VERSION=24;f.exports=i;}),null);
__d('filterSet',['Set'],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=new (c('Set'))();for(var l=i,m=Array.isArray(l),n=0,l=m?l:l[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var o;if(m){if(n>=l.length)break;o=l[n++];}else{n=l.next();if(n.done)break;o=n.value;}var p=o;if(j(p))k.add(p);}return k;}f.exports=h;}),null);
__d('differenceSets',['filterSet'],(function a(b,c,d,e,f,g){'use strict';function h(i){for(var j=arguments.length,k=Array(j>1?j-1:0),l=1;l<j;l++)k[l-1]=arguments[l];return c('filterSet')(i,function(m){return !k.some(function(n){return n.has(m);});});}f.exports=h;}),null);
__d('ConversationNubTabStateList',['invariant','PersistedStore','PinnedConversationNubsConfig','Set','URI','differenceSets'],(function a(b,c,d,e,f,g,h){'use strict';function i(){this.$ConversationNubTabStateList2=new (c('Set'))();this.$ConversationNubTabStateList1=new (c('PersistedStore'))({initialValue:[],storageKeyPrefix:'conversationNubTabState',serializer:i.serializeStateArrayToJson,deserializer:i.deserializeJsonToStateArray,onDataUpdatedOutOfBand:this.$ConversationNubTabStateList3.bind(this),enablePersistence:c('PinnedConversationNubsConfig').persistenceEnabled});}i.prototype.modifyTabState=function(j,k){this.modifyTabs(function(l){var m=l.findIndex(function(n){return n.tabID===j;});m!==-1||h(0);k(l[m]);return l;});};i.prototype.$ConversationNubTabStateList4=function(j){return new (c('Set'))(j.map(function(k){return k.tabID;}));};i.prototype.modifyTabs=function(j){try{this.$ConversationNubTabStateList1.modify(function(k){var l=this.$ConversationNubTabStateList4(k),m=j(k),n=this.$ConversationNubTabStateList4(m);this.$ConversationNubTabStateList2=c('differenceSets')(l,n);return m;}.bind(this));}finally{this.$ConversationNubTabStateList2=new (c('Set'))();}};i.prototype.getTabs=function(){return this.$ConversationNubTabStateList1.getData();};i.prototype.getTabState=function(j){var k=this.getTabStateIfExists(j);k||h(0);return k;};i.prototype.getTabStateIfExists=function(j){return this.getTabs().find(function(k){return k.tabID===j;});};i.prototype.$ConversationNubTabStateList3=function(j,k){var l=j.length!==0,m=this.$ConversationNubTabStateList2.size!==0;if(l||m)this.modifyTabs(function(n){var o=this.$ConversationNubTabStateList4(k),p=this.$ConversationNubTabStateList4(j),q=this.$ConversationNubTabStateList2,r=c('differenceSets')(o,p,q),s=k.filter(function(t){return r.has(t.tabID);});return j.concat(s);}.bind(this));};i.prototype.reloadFromStorageIfNecessary=function(){var j;(j=this.$ConversationNubTabStateList1).reloadFromStorageIfNecessary.apply(j,arguments);};i.serializeStateArrayToJson=function(j){var k=[];if(Array.isArray(j))k=j.map(i.serializeStateToJson).filter(Boolean);return k;};i.serializeStateToJson=function(j){var k=j.permalinkURI?j.permalinkURI.toString():null,l=babelHelpers['extends']({},j,{permalinkURI:k});return l;};i.deserializeJsonToStateArray=function(j){if(Array.isArray(j)){return j.map(i.deserializeJsonToState).filter(Boolean);}else return [];};i.deserializeJsonToState=function(j){if(j!=null&&typeof j.tabID==='string'&&typeof j.ftID==='string'&&typeof j.title==='string'&&typeof j.keepAtBottom==='boolean'&&typeof j.isTabRaised==='boolean'&&typeof j.isBlinkingUnread==='boolean'&&j.allSeenNewComments!=null&&j.allSeenNewComments instanceof Object&&j.unseenCommentsSinceLastCleared!=null&&j.unseenCommentsSinceLastCleared instanceof Object&&typeof j.hasFakeInitBadge==='boolean'&&typeof j.badgeCount==='number'&&typeof j.shouldShowNux==='boolean'&&(j.permalinkURI==null||typeof j.permalinkURI==='string')&&(j.notifAlertID==null||typeof j.notifAlertID==='string')){var k=j.permalinkURI?new (c('URI'))(j.permalinkURI):null,l={tabID:j.tabID,ftID:j.ftID,notifAlertID:j.notifAlertID,title:j.title,keepAtBottom:j.keepAtBottom,isTabRaised:j.isTabRaised,isBlinkingUnread:j.isBlinkingUnread,allSeenNewComments:j.allSeenNewComments,unseenCommentsSinceLastCleared:j.unseenCommentsSinceLastCleared,hasFakeInitBadge:j.hasFakeInitBadge,badgeCount:j.badgeCount,shouldShowNux:j.shouldShowNux,permalinkURI:k};return l;}else return null;};i.prototype.push=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];this.modifyTabs(function(m){k.forEach(function(n){if(m.find(function(o){return o.tabID===n.tabID;})){h(0);}else m.push(n);});return m;});};i.prototype.remove=function(j){this.modifyTabs(function(k){var l=k.findIndex(function(m){return m.tabID===j;});if(l!==-1)k.splice(l,1);return k;});};f.exports=i;}),null);
__d('ConversationNubTabState',['invariant','ConversationNub','ConversationNubTabStateList'],(function a(b,c,d,e,f,g,h){'use strict';var i;function j(){this.$ConversationNubTabState1=Object.create(null);this.$ConversationNubTabState2=new (c('ConversationNubTabStateList'))();this.$ConversationNubTabState3=Infinity;}j.prototype.getTabState=function(k){return this.$ConversationNubTabState2.getTabState(k);};j.prototype.getTabStateIfExists=function(k){return this.$ConversationNubTabState2.getTabStateIfExists(k);};j.prototype.getUnloadedTabs=function(){var k=this.$ConversationNubTabState2.getTabs().filter(function(l){return !this.getLoadedTab(l.tabID);}.bind(this));return k;};j.prototype.setMaxDockTabs=function(k){this.$ConversationNubTabState3=k;};j.prototype.getNumDockTabs=function(){var k=this.$ConversationNubTabState3,l=this.getTotalTabCount();return Math.min(k,l);};j.prototype.getNumMenuTabs=function(){return this.getTotalTabCount()-this.getNumDockTabs();};j.prototype.addTabState=function(k){this.$ConversationNubTabState2.push(k);};j.prototype.addLoadedTab=function(k,l){var m=this.getTabState(k);if(!m)return;var n=this.getLoadedTab(k);if(n)return;this.$ConversationNubTabState1[k]=l;};j.prototype.getLoadedTab=function(k){return this.$ConversationNubTabState1[k];};j.prototype.getLoadedTabByFeedbackTarget=function(k){return this.getLoadedTabs().find(function(l){return l.getPersistentState().ftID===k;});};j.prototype.isTabInDock=function(k){var l=this.getLoadedTab(k);if(!l)return false;var m=this.$ConversationNubTabState4(l);return 0<=m&&m<this.getNumDockTabs();};j.prototype.$ConversationNubTabState4=function(k){return this.getLoadedTabs().indexOf(k);};j.prototype.clearTabNotifications=function(k){this.$ConversationNubTabState2.modifyTabState(k,function(l){l.unseenCommentsSinceLastCleared={};l.hasFakeInitBadge=false;l.badgeCount=0;l.isBlinkingUnread=false;});};j.prototype.deleteTab=function(k){var l=this.getLoadedTab(k);if(l){delete this.$ConversationNubTabState1[k];l.destroy();}this.$ConversationNubTabState2.remove(k);return Boolean(l);};j.prototype.modifyTabState=function(k,l){return this.$ConversationNubTabState2.modifyTabState(k,l);};j.prototype.moveTabToDockLeft=function(k){var l=this.getLoadedTab(k);if(!l)return;this.$ConversationNubTabState2.modifyTabs(function(m){var n=m.findIndex(function(w){return w.tabID===k;});n!==-1||h(0);var o=m[n],p=this.$ConversationNubTabState4(l),q=this.getLoadedTabs().length,r=this.getNumDockTabs();if(p<0||q===0){return m;}else if(r===0){if(p!==0){m.splice(n,1);m.unshift(o);}return m;}var s=r-1;if(p===s)return m;m.splice(n,1);if(p<s)s-=1;var t=this.getLoadedTabs()[s],u=this.getTabState(t.getTabID());u||h(0);var v=m.findIndex(function(w){return w.tabID===u.tabID;});m.splice(v,0,o);return m;}.bind(this));};j.prototype.getLoadedTabs=function(){var k=this.$ConversationNubTabState2.getTabs().map(function(l){return this.getLoadedTab(l.tabID);}.bind(this)).filter(Boolean);return k;};j.prototype.getUnsortedLoadedTabs=function(){var k=Object.values(this.$ConversationNubTabState1);return k;};j.prototype.getTotalTabCount=function(){return this.getUnsortedLoadedTabs().length;};j.prototype.getTabsForDockOldestFirst=function(){return this.getLoadedTabs().slice(0,this.getNumDockTabs());};j.prototype.getTabsForDockNewestFirst=function(){return this.getTabsForDockOldestFirst().slice().reverse();};j.prototype.getTabsForMenu=function(){return this.getLoadedTabs().slice(this.getNumDockTabs()).reverse();};(function(){var k=void 0;function l(){if(!k)k=new j();return k;}f.exports={getConversationNubTabState:l,ConversationNubTabState:j};})();}),null);
__d("XConversationNubTogglePinController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/conversation\/nub_story\/toggle_pin\/",{ft_id:{type:"String"},pin:{type:"Bool",defaultValue:false},with_render:{type:"Bool",defaultValue:false},notif_setting:{type:"Enum",enumType:1}});}),null);
__d("XConversationsToggleController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/ajax\/conversation\/toggle_feature\/",{turn_conversations_on:{type:"Bool",defaultValue:false}});}),null);
__d('ConversationNubUtils',['csx','Arbiter','AsyncFeature','AsyncRequest','DOM','Event','EventListener','ConversationNubTabState','Keys','XConversationNubTogglePinController','XConversationsToggleController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('ConversationNubTabState').getConversationNubTabState,j=i(),k={DISABLE:'disable',ENABLE:'enable'},l='ConversationNubUtils/closeTab',m='ConversationNubUtils/unpinnedFromHeader',n='ConversationNubUtils/recheckTabVisibility',o='ConversationNubUtils/openPermalinkFromHeader',p='ConversationNubUtils/turnOff',q='ConversationNubUtils/turnOn',r='tab-x-out',s='overflow-x-out',t='unpin';function u(na){var oa=Object.values(k);return oa.find(function(pa){return pa===na;})||null;}function v(na,oa,pa,qa){var ra=qa||{},sa=ra.notif_setting,ta=c('XConversationNubTogglePinController').getURIBuilder().setString('ft_id',String(na)).setBool('pin',oa);if(sa&&c('AsyncFeature').__serverHasFeatureImpl(3))ta.setEnum('notif_setting',sa);var ua=ta.getURI(),va=new (c('AsyncRequest'))().setURI(ua).setMethod('POST');if(pa)va.setAllowCrossPageTransition(true);va.send();}function w(na){var oa=c('XConversationsToggleController').getURIBuilder().setBool('turn_conversations_on',na).getURI();na?ma():la();var pa=new (c('AsyncRequest'))().setURI(oa).setAllowCrossPageTransition(true).setHandler(function(qa){if(qa.getPayload().conversationsStatus){ma();}else la();}).setErrorHandler(function(qa){na?la():ma();}).setMethod('POST');pa.send();}function x(na,oa,pa){v(na,true,oa,pa);}function y(na,oa,pa){v(na,false,oa,pa);}function z(na,oa){x(na,false,oa);}function aa(na,oa){y(na,false,oa);}function ba(na,oa){x(na,true,oa);}function ca(na,oa){y(na,true,oa);}function da(){w(false);}function ea(){w(true);}function fa(na){return c('DOM').scry(na,"._4iz6")[0];}function ga(na,oa,pa){var qa=function ra(){pa();};oa.addSubscriptions(c('EventListener').listen(na,'click',qa),c('EventListener').listen(na,'keydown',function(ra){if(c('Event').getKeyCode(ra)===c('Keys').RETURN)qa();}));}function ha(na,oa){var pa=j.getLoadedTab(na);if(!pa)return;var qa=pa.getPersistentState(),ra=pa.getSessionID();c('Arbiter').inform(l,{tabID:na,tabState:qa,sessionID:ra,reason:oa});}function ia(na){var oa=j.getLoadedTab(na);if(!oa)return;c('Arbiter').inform(m,{tab:oa});}function ja(na){c('Arbiter').inform(n,{tab:na});}function ka(na){var oa=j.getLoadedTab(na);if(!oa)return;c('Arbiter').inform(o,{tab:oa});}function la(){c('Arbiter').inform(p,{});}function ma(){c('Arbiter').inform(q,{});}f.exports={CLOSE_TAB_EVENT:l,UNPIN_FROM_HEADER_EVENT:m,OPEN_PERMALINK_FROM_HEADER_EVENT:o,TURN_CONVERSATIONS_OFF_EVENT:p,TURN_CONVERSATIONS_ON_EVENT:q,CLOSE_REASON_TAB_X_OUT:r,CLOSE_REASON_OVERFLOW_X_OUT:s,CLOSE_REASON_UNPIN:t,coerceToPinRequestNotifSetting:u,sendPinRequest:z,sendUnpinRequest:aa,sendPinRequestAcrossTransitions:ba,sendUnpinRequestAcrossTransitions:ca,getCloseButtonElem:fa,addCloseButtonListeners:ga,informShouldCloseTab:ha,informDidUnpinFromHeaderMenu:ia,informShouldRecheckTabVisibility:ja,informOpenPermalinkFromHeader:ka,turnConversationsOff:da,turnConversationsOn:ea};}),null);
__d('ConversationNubPermalinkUtils',['URI','isFacebookURI'],(function a(b,c,d,e,f,g){'use strict';function h(l){return l.substr(-1)==='/'?l.slice(0,-1):l;}function i(l,m){var n=l.getPath(),o=m.getPath();return h(n)===h(o);}function j(l,m,n){var o=l.getQueryData(),p=m.getQueryData(),q=o[n],r=p[n];if(q==null&&r==null)return true;return q===r;}function k(l){var m=new (c('URI'))(window.location.href);return (m&&l&&c('isFacebookURI')(m)&&c('isFacebookURI')(l)&&i(m,l)&&j(m,l,'fbid')&&j(m,l,'story_fbid'));}f.exports={isOnPermalink:k};}),null);
__d('ConversationNubViewportManager',['DockTabsViewportCalculator','DockTabsViewportPinnedConversationTabUtils'],(function a(b,c,d,e,f,g){'use strict';var h=c('DockTabsViewportPinnedConversationTabUtils').getMinRequiredWidthForFirstConvoTab;function i(j,k,l){this.$ConversationNubViewportManager1=j;this.$ConversationNubViewportManager3=k;this.$ConversationNubViewportManager2=c('DockTabsViewportCalculator').getInstance(this.$ConversationNubViewportManager1);this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.registerPinnedConvoTabCallbacks(babelHelpers['extends']({},l,{pinnedConvoTabStateGetter:function(){return this.$ConversationNubViewportManager3;}.bind(this)}));}i.prototype.getNumDockTabsToShow=function(j){return this.getCouldFitAtLeastOneDockTab(j)?1:0;};i.prototype.getCouldFitAtLeastOneDockTab=function(j){var k=h();return k<=j;};i.prototype.forceRecalculatePinnedConvoTabs=function(j){this.$ConversationNubViewportManager2&&this.$ConversationNubViewportManager2.forceRecalculatePinnedConvoTabs(j);};f.exports=i;}),null);
__d('ConversationNubVisibilityDedupeUtils',['Bootloader','emptyFunction','ifRequired'],(function a(b,c,d,e,f,g){'use strict';function h(j){c('Bootloader').loadModules(["UFICommentVisibilityStore"],j,'ConversationNubVisibilityDedupeUtils');}function i(j){return c('ifRequired')('UFICommentVisibilityStore',function(k){return (k.isFeedbackTargetVisible(j));},c('emptyFunction').thatReturnsFalse);}f.exports={bootloadUFIVisibilityModule:h,isFeedbackTargetVisible:i};}),null);
__d("XNotificationNubStoryController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/conversation\/nub_story\/",{notif_alert_id:{type:"String"},notif_id:{type:"Int"},ft_id:{type:"String"},force_minimized:{type:"Bool",defaultValue:false}});}),null);
__d('NotificationConversationController',['csx','cx','Arbiter','AsyncRequest','Bootloader','ConversationNub','ConversationNubTabsUpdateEventController','ConversationNubPermalinkUtils','ConversationNubUtils','ConversationNubViewportManager','ConversationNubVisibilityDedupeUtils','CSS','DOM','ConversationNubTabState','NotificationConstants','NotificationUpdates','PinnedConversationNubsConfig','SubscriptionsHandler','URI','XNotificationNubStoryController','ge','ifRequired'],(function a(b,c,d,e,f,g,h,i){'use strict';var j=c('ConversationNubTabState').getConversationNubTabState,k=c('NotificationConstants').PayloadSourceType,l=k.LIVE_SEND,m=k.OTHER_APPLICATION,n=c('ConversationNubVisibilityDedupeUtils').bootloadUFIVisibilityModule,o=c('ConversationNubVisibilityDedupeUtils').isFeedbackTargetVisible,p=1,q=j(),r=Object.create(null),s=null,t=null,u=null,v=null,w=null,x=null,y=false,z=null,aa=null,ba=null,ca=null,da=Object.create(null);function ea(){if(!t)t=c('DOM').scry(c('ge')('pagelet_dock'),"._1mw-")[0];return t;}function fa(){if(!u){var ia=ea();if(ia)u=c('DOM').scry(ia,"._1tvj")[0];}return u;}function ga(){if(!v){var ia=ea();if(ia)v=c('DOM').scry(ia,"._2ikx .fbNubButton")[0];}return v;}ha.prototype.init=function(){if(y)return;y=true;this.$NotificationConversationController1();var ia='update-notifications',ja=new (c('SubscriptionsHandler'))();ja.addSubscriptions(c('NotificationUpdates').subscribe(ia,function(ka,la){if(la.payloadsource===l&&la.readState&&Object.keys(la.readState).length){this.$NotificationConversationController2(la.readState);}else if(la.payloadsource===l||la.payloadsource===m){var ma=la.nodes;if(ma&&ma.length)this.$NotificationConversationController3(ma);}}.bind(this)),c('ConversationNubTabsUpdateEventController').subscribeToTabsUpdated(this.$NotificationConversationController4.bind(this)),c('Arbiter').subscribe(c('ConversationNubUtils').CLOSE_TAB_EVENT,function(ka,la){var ma=la||{},na=ma.tabID;if(na)this.$NotificationConversationController5(na);}.bind(this)));z=ja;if(c('PinnedConversationNubsConfig').markAsReadWhenViewedInFeed)n(function(ka){ja.addSubscriptions(ka.addListener(this.$NotificationConversationController6.bind(this)));}.bind(this));};ha.prototype.$NotificationConversationController1=function(){q.getUnloadedTabs().forEach(function(ia){this.$NotificationConversationController7(ia.tabID,ia.ftID,ia.permalinkURI,'page_refresh');}.bind(this));};ha.prototype.$NotificationConversationController8=function(ia){var ja=s?s.getNumDockTabsToShow(ia):p;q.setMaxDockTabs(ja);};ha.prototype.$NotificationConversationController9=function(ia,ja){this.$NotificationConversationController8(ia);if(ja){var ka=ja.tabToPromote,la=ja.tabToOpenIfInDock;if(ka&&!q.isTabInDock(ka.getTabID()))q.moveTabToDockLeft(ka.getTabID());if(la&&q.isTabInDock(la.getTabID()))la.popOut();}this.$NotificationConversationController10(ia);};ha.prototype.$NotificationConversationController4=function(ia){s&&s.forceRecalculatePinnedConvoTabs(ia);};ha.prototype.$NotificationConversationController10=function(ia){var ja=q.getTotalTabCount(),ka=q.getNumDockTabs(),la=s&&s.getCouldFitAtLeastOneDockTab(ia),ma=ja>0&&la,na=ka<ja&&ma,oa=ea();if(oa){c('CSS').conditionClass(oa,"_1tvf",ma);c('CSS').conditionClass(oa,"_1dex",na);c('CSS').conditionClass(oa,"_1tvi",na);}var pa=c('PinnedConversationNubsConfig').pinnedToLeft?q.getTabsForDockOldestFirst():q.getTabsForDockNewestFirst();pa.forEach(function(ra){if(ra.getIsRaised())ra.clearBadge();});var qa=q.getTabsForMenu();this.$NotificationConversationController11(pa);this.$NotificationConversationController12(qa);};ha.prototype.$NotificationConversationController2=function(ia){q.getUnsortedLoadedTabs().forEach(function(ka){var la=ka.getNotificationAlertID();if(ia[la])ka.clearBadge();});q.getUnloadedTabs().forEach(function(ka){if(ia[ka.notifAlertID])q.clearTabNotifications(ka.tabID);});var ja=q.getTabsForMenu();this.$NotificationConversationController12(ja);};ha.prototype.$NotificationConversationController3=function(ia){ia.forEach(function(ja){var ka=ja.alert_id,la=ja.pinnedConvoConfig,ma=ja.tracking;if(!la)return;var na=la.tab_id,oa=la.ft_id,pa=la.permalink_uri,qa=JSON.parse(ma),ra=pa?new (c('URI'))(pa):null;this.$NotificationConversationController13(na,qa.alert_id,oa,ka,ra);}.bind(this));};ha.prototype.$NotificationConversationController13=function(ia,ja,ka,la,ma){var na=c('XNotificationNubStoryController').getURIBuilder().setString('notif_alert_id',la).setInt('notif_id',ja);this.$NotificationConversationController14(ka,'notification');this.$NotificationConversationController15(ia,ka,ma,na);};ha.prototype.$NotificationConversationController14=function(ia,ja){if(!da[ia])da[ia]=ja;};ha.prototype.$NotificationConversationController7=function(ia,ja,ka,la){this.$NotificationConversationController14(ja,la);var ma=c('XNotificationNubStoryController').getURIBuilder().setString('ft_id',ja);this.$NotificationConversationController15(ia,ja,ka,ma);};ha.prototype.$NotificationConversationController15=function(ia,ja,ka,la){if(r[ia]||q.getLoadedTab(ia))return;if(c('ConversationNubPermalinkUtils').isOnPermalink(ka)||o(ja))la.setBool('force_minimized',true);r[ia]=true;new (c('AsyncRequest'))().setURI(la.getURI()).setAllowCrossPageTransition(true).setFinallyHandler(function(){delete r[ia];}).send();};ha.prototype.$NotificationConversationController6=function(){var ia=false;q.getUnsortedLoadedTabs().forEach(function(ja){if(ja.getBadgeCount()>0&&o(ja.getFeedbackTargetID())){ja.clearBadge();ia=true;}});if(ia)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ha.prototype.$NotificationConversationController16=function(ia){var ja=true;q.getUnsortedLoadedTabs().forEach(function(ka){var la=ka.getFeedbackTargetID(),ma=ia[la],na=ma?Object.keys(ma):[];if(na.length){var oa=ka.getBadgeCount();if(o(la)){ka.markCommentsAsSeenWithoutBadging(na);ka.clearBadge();}else ka.attemptAddNewCommentsToBadge(na);var pa=ka.getBadgeCount();if(oa!==pa)ja=true;}});if(ja)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ha.prototype.$NotificationConversationController17=function(ia){if(ca)return;c('Bootloader').loadModules(["ConversationNubSurveys"],function(ja){if(!ca)ca=new ja(ia);},'NotificationConversationController');};ha.prototype.$NotificationConversationController18=function(ia,ja,ka){if(ba){ba.addTab(ia,ka);delete da[ia.getPersistentState().ftID];return;}c('Bootloader').loadModules(["ConversationNubLogger"],function(la){if(!ba)ba=new la(ja);ba.addTab(ia,ka);delete da[ia.getPersistentState().ftID];},'NotificationConversationController');};ha.prototype.$NotificationConversationController19=function(){if(aa)return;c('Bootloader').loadModules(["ConversationNubUFICentralUpdateManager"],function(ia){if(aa)return;aa=new ia(this.$NotificationConversationController16.bind(this));}.bind(this),'NotificationConversationController');};ha.prototype.$NotificationConversationController11=function(ia){var ja=fa();if(!ja)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubDockedTabGroup.react"],function(ka,la,ma){x=la.render(ka.createElement(ma,{dockTabs:ia}),ja);},'NotificationConversationController');};ha.prototype.$NotificationConversationController20=function(ia){ia.popOut();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:ia});};ha.prototype.$NotificationConversationController12=function(ia){var ja=ga();if(!ja)return;c('Bootloader').loadModules(["React","ReactDOM","ConversationNubCollapsedSelectorMenu.react"],function(ka,la,ma){w=la.render(ka.createElement(ma,{menuTabs:ia,onTabSelected:this.$NotificationConversationController20.bind(this)}),ja);}.bind(this),'NotificationConversationController');};ha.prototype.$NotificationConversationController21=function(){if(!s){var ia=ea();if(ia){var ja={onAvailableWidthChanged:this.$NotificationConversationController9.bind(this)};s=new (c('ConversationNubViewportManager'))(ia,q,ja);}}};ha.prototype.storyFromServer=function(ia,ja){if(!y)return;var ka=ja.tab_id,la=ja.ft_id,ma=ja.notif_alert_id,na=ja.title,oa=ja.permalink_uri,pa=ja.promote_on_init,qa=ja.attempt_open_on_init,ra=ja.init_without_badge,sa=ja.tab_add_source,ta=q.getLoadedTab(ka);if(ta){if(pa||qa)c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:pa?ta:null,tabToOpenIfInDock:qa?ta:null});return;}ra=ra||o(la);var ua=q.getTabStateIfExists(ka);if(ua){ra=null;}else{var va=c('ConversationNub').createDefaultState(ka,oa,la,ma,na);q.addTabState(va);}var wa=new (c('ConversationNub'))(ia,ka,ra);q.addLoadedTab(ka,wa);qa=qa||wa.getPersistentState().isTabRaised;this.$NotificationConversationController19();this.$NotificationConversationController21();c('ConversationNubTabsUpdateEventController').informTabsUpdated({tabToPromote:pa?wa:null,tabToOpenIfInDock:qa?wa:null});this.$NotificationConversationController17(q);var xa=da[la]||sa||'unknown';this.$NotificationConversationController18(wa,q,xa);};ha.prototype.$NotificationConversationController5=function(ia){var ja=q.deleteTab(ia);if(ja)c('ConversationNubTabsUpdateEventController').informTabsUpdated();};ha.prototype.unsubscribe=function(){z&&z.release();z=null;ba&&ba.destroy();ba=null;ca&&ca.destroy();ca=null;aa&&aa.destroy();aa=null;c('ifRequired')('ReactDOM',function(ia){var ja=ga();if(w&&ja)ia.unmountComponentAtNode(ja);var ka=fa();if(x&&ka)ia.unmountComponentAtNode(ka);});};function ha(){}f.exports=new ha();}),null);