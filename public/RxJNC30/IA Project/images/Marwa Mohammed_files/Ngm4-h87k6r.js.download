if (self.CavalryLogger) { CavalryLogger.start_js(["H\/eh6"]); }

__d("MercuryMessageSourceTags",[],(function a(b,c,d,e,f,g){f.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};}),null);
__d("MercurySendMessageFields",[],(function a(b,c,d,e,f,g){f.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};}),null);
__d("MercuryTimePassed",[],(function a(b,c,d,e,f,g){f.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};}),null);
__d("MercuryTypeaheadConstants",[],(function a(b,c,d,e,f,g){f.exports={COMPOSER_FRIENDS_MAX:4,COMPOSER_FB4C_MAX:4,COMPOSER_NON_FRIENDS_MAX:2,COMPOSER_MESSENGER_ONLY_CONTACT_MAX:4,COMPOSER_SHOW_MORE_LIMIT:2,COMPOSER_THREADS_INITIAL_LIMIT:2,COMPOSER_CHATTAB_MAX:5,COMPOSER_PAGES_MAX:5,COMPOSER_WM_MAX:19,USER_TYPE:"user",PAGE_TYPE:"page",THREAD_TYPE:"thread",HEADER_TYPE:"header",SEARCH_TYPE:"search",FRIEND_TYPE:"friend",NON_FRIEND_TYPE:"non_friend",FB4C_TYPE:"fb4c",MEETING_ROOM_PAGE_TYPE:"meeting_room_page",COMMERCE_PAGE_TYPE:"commerce_page",INTERNAL_BOT_PAGE_TYPE:"internal_bot_page",GAME_TYPE:"game",VALID_EMAIL:"^([A-Z0-9._\u0025+-]+\u0040((?!facebook\\.com))[A-Z0-9.-]+\\.[A-Z]{2,4}|(([A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*)|([A-Z0-9._\u0025+-]+[A-Z._\u0025+-]+[A-Z0-9._\u0025+-]*))\u0040(?:facebook\\.com))$"};}),null);
__d("MessengerApprovalModeTypes",[],(function a(b,c,d,e,f,g){f.exports={OPEN:0,APPROVALS:1};}),null);
__d("MessengerJoinableModeType",[],(function a(b,c,d,e,f,g){f.exports={PRIVATE:0,JOINABLE:1};}),null);
__d("MessengerView",[],(function a(b,c,d,e,f,g){f.exports={DETAIL:{COMPOSE:"detail\/compose",THREAD:"detail\/thread"},MASTER:{GROUPS:"master\/groups",PEOPLE:"master\/people",RECENT:"master\/recent",SUPPORT:"master\/support",SEARCH:"master\/search"}};}),null);
__d("StickerConstants",[],(function a(b,c,d,e,f,g){f.exports={MOBILE_LIKE_STICKER_PACK_ID:"227877430692340",GRAVEYARD_PACK_ID:"604597256247273",LIKE_STICKER_ID:"227878347358915",HOT_LIKE_SMALL_STICKER_ID:"369239263222822",HOT_LIKE_MEDIUM_STICKER_ID:"369239343222814",HOT_LIKE_LARGE_STICKER_ID:"369239383222810",MRU_STICKER_PACK:"599061016853145",SEARCH_PACK_ID:"680229632032514",OZ_PACK_ID:"1456625217993235",SPRITE_PADDING:"24",PayloadSource:{VIEW_ACTION:"view-action"},EMOTICON_PACK_ID:"1471127876485636",DEFAULT_FRAME_RATE:83,TRAY_SIZE:64,THREAD_SIZE:120};}),null);
__d('ChatSearchSource',['requireWeak','AbstractSearchSource','AsyncRequest','CurrentUser','MercuryConfig','MercuryParticipantTypes','SearchableEntry','SearchSourceCallbackManager','ShortProfiles','TokenizeUtil','debounce','emptyFunction','isValidUniqueID'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=null;c('requireWeak')('OrderedFriendsList',function(l){j=l;});h=babelHelpers.inherits(k,c('AbstractSearchSource'));i=h&&h.prototype;function k(l){i.constructor.call(this);this.$ChatSearchSource1=new (c('SearchSourceCallbackManager'))({parseFn:c('TokenizeUtil').parse,matchFn:c('TokenizeUtil').isQueryMatch,indexFn:l.indexFn});this.$ChatSearchSource2=l.queryRequests||[];this.$ChatSearchSource3=false;this.$ChatSearchSource4=c('debounce')(this.$ChatSearchSource4,100,this);}k.prototype.bootstrapImpl=function(l){c('ShortProfiles').fetchAll().done(function(){this.$ChatSearchSource3=true;this.$ChatSearchSource5();l();}.bind(this));};k.prototype.searchImpl=function(l,m,n){var o=null,p={},q=n&&n.onQueryFinished,r=n&&n.onQueryStarted;r&&r(l);var s=this.$ChatSearchSource1.search(l,function(v){if(!o){o=v;o.forEach(function(w){return p[w.getUniqueID()]=true;});}else v.forEach(function(w){var x=w.getUniqueID();if(!p[x]){o.push(w);p[x]=true;}});m(o,l);if(l.length===1&&this.$ChatSearchSource3)q&&q(l);}.bind(this),n);if(!s||!this.$ChatSearchSource2||!this.$ChatSearchSource2.length||l.length===0){q&&q(l);return;}if(l.length===1){if(this.$ChatSearchSource3)q&&q(l);return;}var t={value:l,existing_ids:o&&o.map(function(v){return v.getUniqueID();}).join(','),limit:n&&n.threadLimit},u=this.$ChatSearchSource2.length;this.$ChatSearchSource2.forEach(function(v){this.$ChatSearchSource4(t,v,function(w){this.$ChatSearchSource6(this.$ChatSearchSource7(this.$ChatSearchSource8(w)).filter(function(x){return !!x;}),l);u--;if(u===0){this.$ChatSearchSource1.setQueryStringAsExhausted(l);q&&q(l);}}.bind(this));}.bind(this),this);};k.prototype.getAllEntriesMap=function(){return this.$ChatSearchSource1.getAllEntries();};k.prototype.$ChatSearchSource5=function(){var l=c('ShortProfiles').getCachedProfileIDs(),m=l.filter(function(o){var p=c('ShortProfiles').getNow(o);return (o==c('CurrentUser').getID()||p.type===c('MercuryParticipantTypes').FRIEND||p.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(o.toString())>-1);}),n=m.map(this.$ChatSearchSource9);if(n.length)this.$ChatSearchSource1.addLocalEntries(n);};k.prototype.$ChatSearchSource7=function(l){return l.map(this.$ChatSearchSource10,this);};k.prototype.$ChatSearchSource10=function(l,m){if(l.mercury_thread){if(!j)return null;return j.normalizeThreadEntry(l,m);}var n=l.text,o=l.uid;if(!n||!c('isValidUniqueID')(o))return null;var p=j?j.getActiveRank(o):0;if(j&&!j.contains(o))p+=m;return new (c('SearchableEntry'))({uniqueID:o,title:n,order:p,subtitle:l.subtext,type:l.render_type||l.type,photo:l.photo,uri:l.path,auxiliaryData:{isMessengerUser:l.is_messenger_user,alias:l.alias}});};k.prototype.$ChatSearchSource8=function(l){var m=l.getPayload();if(Array.isArray(m)){return m;}else if(m&&m.entries){return m.entries;}else return [];};k.prototype.$ChatSearchSource9=function(l){var m=c('ShortProfiles').getNow(l),n=l==c('CurrentUser').getID()?c('MercuryParticipantTypes').FRIEND:m.type,o=[m.additionalName,m.alternateName].concat(m.searchTokens||[]).join(' '),p=m.name,q=null;return new (c('SearchableEntry'))({uniqueID:l,title:p,order:j?j.getActiveRank(l):0,subtitle:q,keywordString:o,type:n,photo:m.thumbSrc,uri:m.uri,auxiliaryData:{isMessengerUser:m.is_messenger_user,alias:m.alias}});};k.prototype.$ChatSearchSource4=function(l,m,n,o){new (c('AsyncRequest'))(m.uri).setData(babelHelpers['extends']({},l,m.data)).setMethod('GET').setReadOnly(true).setHandler(n).setErrorHandler(o||c('emptyFunction')).setAllowCrossPageTransition(true).send();};k.prototype.$ChatSearchSource6=function(l,m){if(l.length)this.$ChatSearchSource1.addQueryEntries(l,m);};k.prototype.addLocalEntries=function(l){this.$ChatSearchSource1.addLocalEntries(l);};k.prototype.refreshData=function(){c('ShortProfiles').fetchAll();};f.exports=k;}),null);
__d('WebMessengerEvents',['Arbiter'],(function a(b,c,d,e,f,g){var h=Object.assign(new (c('Arbiter'))(),{MASTER_DOM_CHANGED:'master-dom-changed',DETAIL_DOM_CHANGED:'detail-dom-changed',FOCUS_COMPOSER:'focus-composer',FOCUS_SEARCH:'focus-search',FOCUS_AND_SELECT_SEARCH:'focus-and-select-search',STICKER_CLICKED:'sticker-clicked',SUBMIT_REPLY:'submit-reply',UPDATE_SELECTION:'update-selection',masterDOMChanged:function i(){this.inform(h.MASTER_DOM_CHANGED);},detailDOMChanged:function i(){this.inform(h.DETAIL_DOM_CHANGED);},focusComposer:function i(){this.inform(h.FOCUS_COMPOSER);},focusSearch:function i(){this.inform(h.FOCUS_SEARCH);},focusAndSelectSearch:function i(){this.inform(h.FOCUS_AND_SELECT_SEARCH);},updateSelection:function i(j){this.inform(h.UPDATE_SELECTION,j);},stickerClicked:function i(j,k){this.inform(h.STICKER_CLICKED,{packID:j,stickerID:k});},submitReply:function i(){this.inform(h.SUBMIT_REPLY);}});f.exports=h;}),null);
__d('WebMessengerSubscriptionsHandler',['SubscriptionsHandler'],(function a(b,c,d,e,f,g){var h=new (c('SubscriptionsHandler'))('webmessenger');f.exports=h;}),null);
__d("isWebMessengerURI",[],(function a(b,c,d,e,f,g){function h(i){return /^(\/messages)/.test(i.getPath());}f.exports=h;}),null);
__d('WebMessengerWidthControl',['csx','Arbiter','BlueBar','CSS','CSSClassTransition','Event','Style','URI','ViewportBounds','WebMessengerEvents','WebMessengerSubscriptionsHandler','$','getViewportDimensions','isWebMessengerURI','requestAnimationFrame','shield','throttle'],(function a(b,c,d,e,f,g,h){var i=205,j=981,k=257,l=18,m=848,n=724,o=.57,p=56,q,r,s;function t(y,z,aa){this.masterChanged=y;this.detailChaned=z;c('WebMessengerSubscriptionsHandler').addSubscriptions(c('Event').listen(window,'resize',c('throttle')(c('shield')(u,this,this),100)),c('Arbiter').subscribe(['sidebar/initialized','sidebar/visibility','minisidebar/show'],c('shield')(u,this,this),c('Arbiter').SUBSCRIBE_NEW));var ba=x()?p:0;if(aa)ba=i;this._width=x()?0:m;s=true;u(this,ba);}function u(y,z){var aa=c('ViewportBounds').getRight()+c('ViewportBounds').getLeft();aa=aa||z||0;var ba=c('getViewportDimensions').withoutScrollbars().width-aa,ca=Math.round(Math.max(0,ba/2-j/2));ba=j+ca-k;ba-=l;ba=Math.max(n,Math.min(m,ba));if(!isNaN(ba)&&y._width!==ba){y._width=ba;var da=Math.round(ba/(1+o)),ea=ba-da;y.masterChanged(ea);y.detailChaned(da);if(x()){var fa=ba+k;v(function(){if(r){document.body.className=r;r='';}w(fa+'px');s&&c('WebMessengerEvents').detailDOMChanged();s=false;},r);}}}function v(y,z){c('requestAnimationFrame')(y);}function w(y){c('Style').set(c('BlueBar').getNavRoot(),'width',y);c('Style').set(c('$')('globalContainer'),'width',y);}function x(){if(!q)q=c('CSS').matchesSelector(document.body,"._6nw");return q;}c('CSSClassTransition').registerHandler(function(y,z,aa,ba){function ca(da){return x()&&c('isWebMessengerURI')(new (c('URI'))(da));}if(ca(ba)){r=z;return true;}else if(ca(aa)){v(function(){y.className=z;w('');},true);return true;}});f.exports=t;}),null);
__d('Dock',['csx','Event','shield','WebMessengerWidthControl','Arbiter','ArbiterMixin','BlueBar','ChatQuietLinks','CSS','DataStore','DOM','Parent','Scroll','Style','Toggler','Vector','emptyFunction'],(function a(b,c,d,e,f,g,h){c('WebMessengerWidthControl');function i(){}Object.assign(i,c('ArbiterMixin'),{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function j(k){this.init=c('emptyFunction');this.rootEl=k;this.calculateViewportDimensions();c('ChatQuietLinks').removeEmptyHrefs(this.rootEl);c('Event').listen(k,'click',this._onClick.bind(this));c('Event').listen(window,'resize',this._onWindowResize.bind(this));c('Toggler').subscribe(['show','hide'],function(l,m){var n=m.getActive();if(!c('DOM').contains(k,n))return;if(c('CSS').hasClass(n,'fbNub')){this.notifyNub(n,l);if(l==='show')this._resizeNubFlyout(n);}else{var o=c('Parent').byClass(n,'fbNubFlyout');if(o)c('CSS').conditionClass(o,'menuOpened',l==='show');}}.bind(this));this.inform('init',{},c('Arbiter').BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function j(){return this.viewportDimensions=c('Vector').getViewportDimensions();},getFlyoutHeightOffset:function j(){if(this.flyoutHeightOffset)return this.flyoutHeightOffset;this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+c('Vector').getElementDimensions(this.rootEl).y;var k=c('BlueBar').getBar();if(k){var l=c('Style').isFixed(k)?'viewport':'document';this.flyoutHeightOffset+=c('Vector').getElementPosition(k,l).y+c('Vector').getElementDimensions(k).y;}return this.flyoutHeightOffset;},toggle:function j(k){var l=this._findFlyout(k);if(!l)return;this.subscribe('init',function(){c('Toggler').toggle(k);});},show:function j(k){this.subscribe('init',function(){c('Toggler').show(k);});},showNub:function j(k){c('CSS').show(k);},hide:function j(k){this.subscribe('init',function(){var l=c('Toggler').getInstance(k);c('DOM').contains(k,l.getActive())&&l.hide();});},hideNub:function j(k){c('CSS').hide(k);this.hide(k);},setUseMaxHeight:function j(k,l){c('CSS').conditionClass(k,'maxHeight',l!==false);this._resizeNubFlyout(k);},_resizeNubFlyout:function j(k){var l=this._findFlyout(k);if(!l||c('CSS').hasClass(k,'placeholder')||!(c('CSS').hasClass(k,'openToggler')||c('CSS').hasClass(k,'opened')))return;var m=c('DOM').find(l,'div.fbNubFlyoutOuter'),n=c('DOM').find(m,'div.fbNubFlyoutInner'),o=c('DOM').find(n,'div.fbNubFlyoutBody'),p=c('Scroll').getTop(o),q=o.offsetHeight;c('Style').set(o,'height','auto');var r=c('Vector').getElementDimensions(l),s=c('Vector').getElementDimensions(o),t=this.getMaxFlyoutHeight(k);c('Style').set(l,'max-height',t+'px');c('Style').set(m,'max-height',t+'px');r=c('Vector').getElementDimensions(l);var u=c('Vector').getElementDimensions(n),v=u.y-s.y,w=r.y-v,x=parseInt(o.style.height||o.clientHeight,10),y=w!==x;if(r.y>v&&y)c('Style').set(o,'height',w+'px');c('CSS').removeClass(l,'swapDirection');var z=c('Vector').getElementPosition(l).x;c('CSS').conditionClass(l,'swapDirection',function(){if(z<0)return true;return z+r.x>this.viewportDimensions.x;}.bind(this)());if(y&&p+q>=s.y){c('Scroll').setTop(o,o.scrollHeight);}else c('Scroll').setTop(o,p);this.notifyNub(k,'resize');},getMaxFlyoutHeight:function j(k){var l=this._findFlyout(k),m=c('Vector').getElementPosition(l,'viewport'),n=c('Vector').getElementDimensions(l),o=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.getFlyoutHeightOffset())-(this.viewportDimensions.y-m.y-n.y);return Math.max(o,0);},resizeAllFlyouts:function j(){var k=this._getAllNubs(),l=k.length;while(l--)this._resizeNubFlyout(k[l]);},hideAllFlyouts:function j(){var k=this._getAllNubs(),l=k.length;while(l--)this.hide(k[l]);},_getAllNubs:function j(){var k=c('DOM').scry(this.rootEl,"div._50-v.openToggler");return k.concat(c('DOM').scry(this.rootEl,"div._50-v.opened"));},_onClick:function j(event){var k=event.getTarget(),l=c('Parent').byClass(k,'fbNub');if(l){if(c('Parent').byClass(k,'fbNubFlyoutTitlebar')){var m=c('Parent').byTag(k,'a'),n=k.nodeName=='INPUT'&&k.getAttribute('type')=='submit';if(!m&&!n){this.hide(l);return false;}}this.notifyNub(l,'click');}},_onWindowResize:function j(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function j(k){return c('CSS').hasClass(k,'fbNubFlyout')?k:c('DOM').scry(k,'div.fbNubFlyout')[0]||null;},registerNubController:function j(k,l){c('DataStore').set(k,'dock:nub:controller',l);l.subscribe('nub/button/content-changed',c('shield')(this.inform,this,'resize',k));l.subscribe('nub/flyout/content-changed',c('shield')(this._resizeNubFlyout,this,k));},unregisterNubController:function j(k){c('DataStore').remove(k,'dock:nub:controller');},notifyNub:function j(k,l,m){var n=c('DataStore').get(k,'dock:nub:controller');n&&n.inform(l,m);}});f.exports=b.Dock||i;}),null);
__d('NubController',['ArbiterMixin','Dock'],(function a(b,c,d,e,f,g){function h(){}Object.assign(h.prototype,c('ArbiterMixin'),{init:function i(j){this.el=j;c('Dock').registerNubController(j,this);return this;},buttonContentChanged:function i(){this.inform('nub/button/content-changed');},flyoutContentChanged:function i(){this.inform('nub/flyout/content-changed');},hide:function i(){c('Dock').hide(this.el);},show:function i(){c('Dock').show(this.el);}});f.exports=h;}),null);
__d('MercuryTimestamp',['fbt','formatDate','MercuryTimePassed'],(function a(b,c,d,e,f,g,h){var i=86400000,j=6*i,k={getFormatedTimestamp:function l(m){var n=m/1000;return k.getFormattedTimestampByBucket(n,this.getTimeBucket(m));},getAbsoluteTimestamp:function l(m){if(m==null){return null;}else{var n=k.getFormatedTimestamp(m);return n.absolute;}},getRelativeTimestamp:function l(m){var n=k.getFormatedTimestamp(m);return n.relative;},getFormattedTimestampByBucket:function l(m,n){switch(n){case c('MercuryTimePassed').TODAY:return {absolute:h._("Today"),relative:c('formatDate')(m,'g:ia')};case c('MercuryTimePassed').WEEK_AGO:return {absolute:c('formatDate')(m,'l'),relative:c('formatDate')(m,'D')};case c('MercuryTimePassed').CURRENT_YEAR:return {absolute:c('formatDate')(m,'F j'),relative:c('formatDate')(m,'M j')};default:return {absolute:c('formatDate')(m,'F j, Y'),relative:c('formatDate')(m,'n/j/y')};}},getTimeBucket:function l(m){var n=new Date(m),o=new Date(),p=new Date(o.getFullYear(),o.getMonth(),o.getDate());if(p<n){return c('MercuryTimePassed').TODAY;}else if(p-j<n){return c('MercuryTimePassed').WEEK_AGO;}else if(p.getFullYear()===n.getFullYear()){return c('MercuryTimePassed').CURRENT_YEAR;}else return c('MercuryTimePassed').OTHER_YEAR;},getPreciseTimestamp:function l(m){return c('formatDate')(new Date(m),k.getPreciseFormat(m));},getPreciseFormat:function l(m){var n=k.getTimeBucket(m);switch(n){case c('MercuryTimePassed').TODAY:return 'g:ia';case c('MercuryTimePassed').WEEK_AGO:return 'l g:ia';case c('MercuryTimePassed').CURRENT_YEAR:return 'F jS, g:ia';case c('MercuryTimePassed').OTHER_YEAR:default:return 'F j, Y g:i a';}}};f.exports=k;}),null);
__d('MercuryMessageObject',['fbt','BanzaiODS','MercuryActionStatus','MercuryActionType','MercuryIDs','MercuryLocalIDs','MercuryMessageClientState','MercuryMessageSourceTags','MercurySingletonProvider','MercurySourceType','MercuryThreads','MercuryTimePassed','MercuryTimestamp','MercurySendMessageFields','formatDate'],(function a(b,c,d,e,f,g,h){i.getForFBID=function(n){'use strict';return m.getForFBID(n);};i.get=function(){'use strict';return m.get();};function i(n){'use strict';this.$MercuryMessageObject1=n;this.$MercuryMessageObject2=c('MercuryThreads').getForFBID(n);}i.prototype.constructUserGeneratedMessageObject=function(n,o,p,q,r){'use strict';var s=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,o,p);if(typeof n=='string')n=n.replace(/^\s+/,'').replace(/\s+$/,'');s.body=n;s.has_attachment=false;s.html_body=false;s.attachments=[];s.specific_to_list=q||[];s.creator_info=r;return s;};i.prototype.constructStickerMessageObject=function(n,o,p){'use strict';var q=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,o,p);q.has_attachment=true;q.html_body=false;q.attachments=[];q.sticker_id=n;q.specific_to_list=[];return q;};i.prototype.constructAttachmentMessageObject=function(n,o){'use strict';var p=j(this.$MercuryMessageObject1,c('MercuryActionType').USER_GENERATED_MESSAGE,n,o);p.attachments=[];p.specific_to_list=[];return p;};i.prototype.constructLogMessageObject=function(n,o,p,q){'use strict';var r=j(this.$MercuryMessageObject1,c('MercuryActionType').LOG_MESSAGE,n,o);r.log_message_type=p;r.log_message_data=q;if(q&&q.untypedData&&q.untypedData.ttl)r.ephemeral_ttl_mode=q.untypedData.ttl;return r;};i.prototype.constructCTAConfirmationMessageObject=function(n,o,p,q){'use strict';var r=this.constructUserGeneratedMessageObject(n,o,p,null,null),s={};if(q){s={quick_replies:q,ignore_for_webhook:false};}else s={ignore_for_webhook:true};r.platform_xmd=JSON.stringify(s);return r;};i.prototype.normalizeNewMessage=function(n){'use strict';if(n.status===undefined)n.status=c('MercuryActionStatus').UNSENT;n.timestamp_absolute=h._("Today").toString();n.offline_threading_id=n.offline_threading_id||c('MercuryLocalIDs').generateOfflineThreadingID(n.timestamp);if(!n.offline_threading_id)c('BanzaiODS').bumpEntityKey('chat.web','invalid_otid_generated');n.message_id=n.message_id||n.offline_threading_id;var o=c('MercuryIDs').getParticipantIDFromUserID(this.$MercuryMessageObject1);n.specific_to_list=n.specific_to_list||[];if(n.specific_to_list.length&&n.specific_to_list.indexOf(o)===-1)n.specific_to_list.push(o);if(!n.thread_id){n.thread_id='root:'+n.offline_threading_id;}else{var p=this.$MercuryMessageObject2.getThreadMetaNow(n.thread_id);if(p&&p.ephemeral_ttl_mode!==null&&n.ephemeral_ttl_mode===undefined)n.ephemeral_ttl_mode=p.ephemeral_ttl_mode;}if(n.specific_to_list.length==1){n.thread_id='user:'+this.$MercuryMessageObject1;}else if(n.specific_to_list.length==2){var q=n.specific_to_list[0]==o?n.specific_to_list[1]:n.specific_to_list[0];n.thread_id=c('MercuryIDs').getThreadIDFromParticipantID(q);}if(!n.specific_to_list.length){var r=c('MercuryIDs').tokenize(n.thread_id),s=r.type,t=r.value;if(s=='user')n.specific_to_list=['fbid:'+t,o];}if(!n[c('MercurySendMessageFields').MANUAL_RETRY_CNT])n[c('MercurySendMessageFields').MANUAL_RETRY_CNT]=0;};i.prototype.normalizeResendMessage=function(n){'use strict';n.status=c('MercuryActionStatus').RESENDING;n.timestamp=Date.now();n[c('MercurySendMessageFields').MANUAL_RETRY_CNT]+=1;};i.prototype.normalizeAddAttachmentPlaceholder=function(n,o,p){'use strict';if(p.preview_attachments.length>0){n.has_attachment=true;n.preview_attachments=p.preview_attachments;}n.client_state=c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER;n.status=c('MercuryActionStatus').RESENDING;n.upload_id=o;};function j(n,o,p,q){var r=l(p)?[c('MercuryMessageSourceTags').CHAT]:[],s=Date.now(),t=c('formatDate')(new Date(s),'g:ia'),u=k(s),v={action_type:o,thread_id:q,author:c('MercuryIDs').getParticipantIDFromUserID(n),author_email:null,timestamp:s,timestamp_absolute:u,timestamp_relative:t,timestamp_time_passed:c('MercuryTimePassed').TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_filtered_content_bh:false,is_filtered_content_account:false,is_filtered_content_quasar:false,is_filtered_content_invalid_app:false,is_spoof_warning:false,source:p,source_tags:r};return v;}function k(n){try{return new Date(n).toLocaleDateString();}catch(o){var p=c('MercuryTimestamp').getFormatedTimestamp(n);return p.absolute;}}function l(n){switch(n){case c('MercurySourceType').CHAT_WEB:case c('MercurySourceType').CHAT_JABBER:case c('MercurySourceType').CHAT_IPHONE:case c('MercurySourceType').CHAT_MEEBO:case c('MercurySourceType').CHAT_ORCA:case c('MercurySourceType').CHAT_TEST:case c('MercurySourceType').CHAT:return true;default:return false;}}var m=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryMessageActions',['MercuryActionType','MercuryDispatcher','MercuryMessageObject','MercuryPayloadSource','MercuryServerRequests','MercurySingletonMixin'],(function a(b,c,d,e,f,g){'use strict';function h(i){this.$MercuryMessageActions1=i;this.$MercuryMessageActions2=c('MercuryMessageObject').getForFBID(this.$MercuryMessageActions1);this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryMessageActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryMessageActions1);}h.prototype.send=function(i,j,k){j=j||Function.prototype;this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));this.__serverRequests.sendNewMessage(i,k);j(i.thread_id);};h.prototype.resend=function(i,j){var k=babelHelpers['extends']({},i);this.$MercuryMessageActions2.normalizeResendMessage(k);this.send(k,undefined,j);};h.prototype.addAttachmentPlaceholder=function(i,j,k){this.$MercuryMessageActions2.normalizeAddAttachmentPlaceholder(i,j,k);this.$MercuryMessageActions2.normalizeNewMessage(i);this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload(babelHelpers['extends']({},i),c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.cancelAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype.confirmAttachmentPlaceholder=function(i,j){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({upload_id:i,upload_data:j,action_type:c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER},c('MercuryPayloadSource').CLIENT_SEND_MESSAGE));};h.prototype['delete']=function(i,j,k){this.__dispatcher.handleUpdate(this.$MercuryMessageActions3(i,j,c('MercuryActionType').DELETE_MESSAGES,k||c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES));};h.prototype.unwrap=function(i){this.__dispatcher.handleUpdate(this.__constructClientSingleMessagePayload({thread_id:i.thread_id,unwrapped_message_id:i.message_id,action_type:c('MercuryActionType').UNWRAP_MESSAGE},c('MercuryPayloadSource').CLIENT_UNWRAP_MESSAGE));};h.prototype.__constructClientSingleMessagePayload=function(i,j){return {actions:[i],from_client:true,payload_source:j};};h.prototype.$MercuryMessageActions4=function(i,j){return {actions:[i],from_client:false,payload_source:j};};h.prototype.$MercuryMessageActions3=function(i,j,k,l){return {actions:[{action_type:k,thread_id:i,message_ids:j}],from_client:true,payload_source:l};};Object.assign(h,c('MercurySingletonMixin'));f.exports=h;}),null);
__d('MercuryViewer',['CurrentUser','MercuryAssert'],(function a(b,c,d,e,f,g){'use strict';var h='fbid:'+c('CurrentUser').getID(),i={getID:function j(){return h;},isViewer:function j(k){c('MercuryAssert').isParticipantID(k);return k===h;}};f.exports=i;}),null);
__d("XMercuryThreadLikeIconController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/mercury\/like_icon\/",{emoji:{type:"String",defaultValue:""}});}),null);
__d("XMessagingGroupJoinThroughHashController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/join_through_hash\/",{link_hash:{type:"String"}});}),null);
__d("XMessagingGroupJoinableAcceptController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_accept\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupJoinableInviteController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_invite\/",{thread_fbid:{type:"String"},user_ids:{type:"IntSet"}});}),null);
__d("XMessagingGroupJoinableRejectController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/joinable_reject\/",{thread_fbid:{type:"String"},user_id:{type:"Int"}});}),null);
__d("XMessagingGroupSetApprovalController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_approval_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingGroupSetJoinableController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/set_joinable_mode\/",{set_mode:{type:"Enum",enumType:0},thread_fbid:{type:"String"}});}),null);
__d("XMessagingSaveAdminsController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_admins\/",{elem_id:{type:"String"},parent_elem_id:{type:"String"},thread_fbid:{type:"String"},admin_ids:{type:"FBIDSet"},add:{type:"Bool",defaultValue:false}});}),null);
__d("XMessagingSaveNicknameController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_nickname\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadColorController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_color\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XMessagingSaveThreadEmojiController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/messaging\/save_thread_emoji\/",{source:{type:"Enum",required:true,enumType:1}});}),null);
__d("XNFXMessengerBlockActionController",["XController"],(function a(b,c,d,e,f,g){f.exports=c("XController").create("\/nfx\/block_messages\/",{thread_fbid:{type:"Int",required:true},av:{type:"Int"},location:{type:"Enum",required:true,enumType:1},__asyncDialog:{type:"Int"}});}),null);
__d('MercuryThreadActions',['cssVar','AsyncDialog','AsyncRequest','EmojiLikeConstants','MercuryActionType','MercuryAPIArgsSource','MercuryAssert','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessengerBlockingUtils','MercuryPayloadSource','MercuryServerPayloadPreprocessor','MercuryServerRequests','MercurySingletonMixin','MercurySourceType','MercuryThreadIDMap','MercuryThreads','MercuryViewer','MercuryMessageActions','MercuryMessageObject','MessagingTag','URI','XMercuryThreadLikeIconController','XMessagingGroupJoinableAcceptController','XMessagingGroupJoinableInviteController','XMessagingGroupJoinableRejectController','XMessagingGroupJoinThroughHashController','XMessagingGroupSetApprovalController','XMessagingGroupSetJoinableController','XMessagingSaveAdminsController','XMessagingSaveNicknameController','XMessagingSaveThreadColorController','XMessagingSaveThreadEmojiController','XNFXMessengerBlockActionController'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('MercuryThreadIDMap').get(),j=c('MercuryThreads').get(),k=c('MercuryMessageActions').get(),l=c('MercuryMessageObject').get();function m(n){this.$MercuryThreadActions1=n;this.__serverRequests=c('MercuryServerRequests').getForFBID(this.$MercuryThreadActions1);this.__dispatcher=c('MercuryDispatcher').getForFBID(this.$MercuryThreadActions1);this.__payloadPreprocessor=c('MercuryServerPayloadPreprocessor').getForFBID(this.$MercuryThreadActions1);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__dispatcher.handleUpdate(this.$MercuryThreadActions2(n,false,o));};m.prototype.markSeen=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MARK_THREAD_SEEN,c('MercuryPayloadSource').CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions3(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,c('MessagingTag').INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.$MercuryThreadActions4(n,o));};m.prototype['delete']=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__dispatcher.handleUpdate(this.__constructClientPayload(n,c('MercuryActionType').DELETE_THREAD,c('MercuryPayloadSource').CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mute_until:o}));};m.prototype.updateMentionsMuteSetting=function(n,o){var p=o?1:0;this.__serverRequests.changeMentionsMutingOnThread(n,p);this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').CHANGE_MUTE_SETTINGS,c('MercuryPayloadSource').CLIENT_CHANGE_MUTE_SETTINGS,{mentions_mute_mode:p}));};m.prototype.blockMessages=function(n){var o=c('XNFXMessengerBlockActionController').getURIBuilder().setInt('thread_fbid',c('MercuryIDs').getUserIDFromThreadID(n)).setEnum('location','www_chat_head').getURI();c('AsyncDialog').send(new (c('AsyncRequest'))(o));};m.prototype.unblockMessages=function(n){var o=JSON.stringify({reportable_ent_token:c('MercuryIDs').getUserIDFromThreadID(n),initial_action_name:c('MercuryMessengerBlockingUtils').block_messages});new (c('AsyncRequest'))(new (c('URI'))('/ajax/nfx/messenger_undo_block').addQueryData({story_location:'messenger',context:o})).send();};m.prototype.leaveGroup=function(n){if(!j.isEmptyLocalThread(n))k.send(l.constructLogMessageObject(c('MercurySourceType').TITAN_WEB,n,c('MercuryLogMessageType').UNSUBSCRIBE,{removed_participants:[c('MercuryViewer').getID()]}),null,c('MercuryAPIArgsSource').WEBMESSENGER);};m.prototype.changeThreadColor=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={};if(o!="#0084ff")r.color_choice=o;r.thread_or_other_fbid=q;var s=c('XMessagingSaveThreadColorController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(s).setMethod('POST').setData(r).send();});};m.prototype.changeThreadEmoji=function(n,o,p){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(q){var r={},s=String.fromCodePoint.apply(String,o);if(s!==String.fromCodePoint(c('EmojiLikeConstants').FB_THUMBS_UP_EMOJI)&&s!==String.fromCodePoint(c('EmojiLikeConstants').THUMBS_UP_EMOJI_CODES))r.emoji_choice=s;r.thread_or_other_fbid=q;var t=c('XMessagingSaveThreadEmojiController').getURIBuilder().setEnum('source',p).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(r).send();});};m.prototype.changeThreadNicknames=function(n,o,p,q){if(j.isEmptyLocalThread(n))return;i.getServerIDFromClientID(n,function(r){var s={thread_or_other_fbid:r,participant_id:o,nickname:p},t=c('XMessagingSaveNicknameController').getURIBuilder().setEnum('source',q).getURI();new (c('AsyncRequest'))(t).setMethod('POST').setData(s).send();});};m.prototype.setJoinableMode=function(n,o){var p=c('XMessagingGroupSetJoinableController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.setApprovalMode=function(n,o){var p=c('XMessagingGroupSetApprovalController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData({set_mode:n,thread_fbid:o.thread_fbid}).send();};m.prototype.changeGroupAdmins=function(n,o,p){var q={thread_fbid:n,admin_ids:o,add:p},r=c('XMessagingSaveAdminsController').getURIBuilder().getURI();new (c('AsyncRequest'))(r).setMethod('POST').setData(q).send();};m.prototype.joinThroughHash=function(n){var o={link_hash:n},p=c('XMessagingGroupJoinThroughHashController').getURIBuilder().getURI();new (c('AsyncRequest'))(p).setMethod('POST').setData(o).send();};m.prototype.inviteToJoinableGroup=function(n,o){var p={thread_fbid:n,user_ids:o},q=c('XMessagingGroupJoinableInviteController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.acceptToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableAcceptController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.rejectToJoinableGroup=function(n,o){var p={thread_fbid:n,user_id:o},q=c('XMessagingGroupJoinableRejectController').getURIBuilder().getURI();new (c('AsyncRequest'))(q).setMethod('POST').setData(p).send();};m.prototype.addParticipants=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').ADD_PARTICIPANTS,c('MercuryPayloadSource').CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.updateCustomLike=function(n,o){var p=c('XMercuryThreadLikeIconController').getURIBuilder().setString('emoji',o).getURI();new (c('AsyncRequest'))().setURI(p).setHandler(function(q){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_CUSTOM_LIKE,c('MercuryPayloadSource').CLIENT_CHANGE_CUSTOM_LIKE,{custom_like:q.getPayload()}));}.bind(this)).send();};m.prototype.movePendingToInbox=function(n){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').MOVE_PENDING_TO_INBOX,c('MercuryPayloadSource').CLIENT_MOVE_PENDING_TO_INBOX));};m.prototype.updateSnippet=function(n,o){this.__dispatcher.handleUpdate(this.__constructClientPayload([n],c('MercuryActionType').UPDATE_SNIPPET,c('MercuryPayloadSource').CLIENT_UPDATE_SNIPPET,{deleted_ids:o}));};m.prototype.$MercuryThreadActions2=function(n,o,p){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_READ_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_ARCHIVED_STATUS,c('MercuryPayloadSource').CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions4=function(n,o){return this.__constructClientPayload(n,c('MercuryActionType').CHANGE_FOLDER,c('MercuryPayloadSource').CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return babelHelpers['extends']({action_type:o,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,c('MercurySingletonMixin'));f.exports=m;}),null);
__d('ChatActivity',['Arbiter','Event','JSLogger','MercuryConfig','PresenceState','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryConfig').activity_limit||60000,i=c('MercuryConfig').idle_limit||1800000,j=c('MercuryConfig').idle_poll_interval||300000,k=c('JSLogger').create('chat_activity'),l=Date.now(),m=true;function n(){var r=Date.now();return !!(m&&r-l<h);}var o=Object.assign(new (c('Arbiter'))(),{isActive:n});function p(){var r=l;l=Date.now();if(l-r>i){k.debug('idle_to_active',r);c('PresenceState').doSync();}o.inform('activity');}c('Event').listen(window,'focus',function(){m=true;p();});c('Event').listen(window,'blur',function(){m=false;});c('UserActivity').subscribe(function(){p();});function q(r){var s=r&&r.at&&c('PresenceState').verifyNumber(r.at);if(typeof s!=='number')s=null;return s||0;}setInterval(function(){var r=Date.now(),s=q(c('PresenceState').get()),t=Math.max(l,s);if(r-t>i){k.debug('idle',{cookie:s,local:l});o.inform('idle',r-t);}},j);c('PresenceState').registerStateStorer(function(r){var s=q(r);if(s<l)r.at=l;return r;});c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(r,s){s.chat_activity={activity_limit:h,idle_limit:i,idle_poll_interval:j,last_active_time:l};});f.exports=o;}),null);
__d('MessengerFluxReduceDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(){h.apply(this,arguments);}f.exports=new j({strict:false});}),null);
__d('MessengerSharedMediaActions',['MessengerFluxReduceDispatcher','keyMirror'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirror')({CURRENT_LOADED:null,DELETE_PHOTOS:null,LATEST_LOADED:null,LOAD_CURRENT:null,LOAD_MORE_LATEST:null,LOAD_MORE_PREVIOUS:null,PREVIOUS_LOADED:null}),i='MessengerSharedMedia',j={Types:h,Namespace:i,currentLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.CURRENT_LOADED,namespace:i,data:l});},deletePhotos:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.DELETE_PHOTOS,namespace:i,threadFBID:l,photoFBIDs:m});},loadCurrent:function k(l,m){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_CURRENT,namespace:i,threadFBID:l,photoID:m});},loadMorePrevious:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_PREVIOUS,namespace:i,threadFBID:l,afterCursor:m,first:n});},loadMoreLatest:function k(l,m,n){c('MessengerFluxReduceDispatcher').dispatch({type:h.LOAD_MORE_LATEST,namespace:i,threadFBID:l,beforeCursor:m,last:n});},previousLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.PREVIOUS_LOADED,namespace:i,data:l});},latestLoaded:function k(l){c('MessengerFluxReduceDispatcher').dispatch({type:h.LATEST_LOADED,namespace:i,data:l});}};f.exports=j;}),null);
__d('MercuryMessages',['invariant','BanzaiODS','ChatReliabilityInstrumentation','EventEmitter','ImmutableObject','LogHistory','Map','MercuryActionStatus','MercuryActionType','MercuryAssert','MercuryAttachment','MercuryDispatcher','MercuryIDs','MercuryLogMessageType','MercuryMessageClientState','MercuryPayloadSource','MercurySingletonProvider','MercuryMessageActions','MercuryMessageIDs','MessagingGiftWrapConstants','MessengerSharedMediaActions','RangedCallbackManager','MercurySendMessageFields','MercuryServerRequests','MercuryThreadActions','MercuryThreadInformer','MercuryThreads','URI','isMessengerDotComURI','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=new (c('EventEmitter'))(),j=c('LogHistory').getInstance('mercury_messages');function k(p){switch(p){case c('MercuryPayloadSource').UNKNOWN:case c('MercuryPayloadSource').SERVER_INITIAL_DATA:case c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO:case c('MercuryPayloadSource').SERVER_THREAD_SYNC:return true;}return false;}l.getForFBID=function(p){return o.getForFBID(p);};l.get=function(){return o.get();};function l(p){this.$MercuryMessages1=p;this.$MercuryMessages2=c('MercuryMessageActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages3=c('MercuryServerRequests').getForFBID(this.$MercuryMessages1);this.$MercuryMessages4=c('MercuryThreadInformer').getForFBID(this.$MercuryMessages1);this.$MercuryMessages5=c('MercuryThreads').getForFBID(this.$MercuryMessages1);this.$MercuryMessages6=c('MercuryThreadActions').getForFBID(this.$MercuryMessages1);this.$MercuryMessages7=c('MercuryDispatcher').getForFBID(this.$MercuryMessages1);this.$MercuryMessages8=false;this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};this.$MercuryMessages14={};this.$MercuryMessages7.subscribe('update-messages',function(q,r){var s=(r.actions||[]).filter(function(u){var v=u.action_type,w=(u.is_forward||u.thread_id)&&(v==c('MercuryActionType').LOG_MESSAGE||v==c('MercuryActionType').USER_GENERATED_MESSAGE||v==c('MercuryActionType').SEND_MESSAGE||v==c('MercuryActionType').DELETE_THREAD||v==c('MercuryActionType').DELETE_MESSAGES),x=u.upload_id&&u.upload_data&&(v==c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER||v==c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER),y=u.reaction&&v==c('MercuryActionType').REACTION_UPDATE,z=u.replaced_message_id&&v==c('MercuryActionType').REPLACE_MESSAGE,aa=u.unwrapped_message_id&&v==c('MercuryActionType').UNWRAP_MESSAGE;return w||x||y||z||aa;}),t=k(r.payload_source);this.handleUpdates(s,t,r.payload_source,r.from_client);if(r.end_of_history)this.$MercuryMessages15(r.end_of_history,r.payload_source);if(this.$MercuryMessages8){this.$MercuryMessages8=false;i.emit('change');}}.bind(this));this.$MercuryMessages7.subscribe('invalidate-thread-state',function(q,r){this.$MercuryMessages16(r);}.bind(this));this.$MercuryMessages7.subscribe('invalidate-global-state',function(){return this.invalidateGlobalState();}.bind(this));j.debug('constructed',JSON.stringify({fbid:this.$MercuryMessages1}));}l.prototype.getMessagesFromIDs=function(p){return (p||[]).map(function(q){return this.$MercuryMessages17(q);}.bind(this)).filter(function(q){return q;});};l.prototype.getServerMessageID=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return q;};l.prototype.hasLoadedNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.hasReachedEndOfArray()||r.getCurrentArraySize()>=q;};l.prototype.hasLoadedExactlyNMessages=function(p,q){var r=this.$MercuryMessages18(p);return r.getCurrentArraySize()==q;};l.prototype.invalidateGlobalState=function(){var p=Object.keys(this.$MercuryMessages10);this.$MercuryMessages9={};this.$MercuryMessages10={};this.$MercuryMessages11={};this.$MercuryMessages12=new (c('Map'))();this.$MercuryMessages13={};p.map(function(q){return this.$MercuryMessages4.invalidatedThread(q);}.bind(this));};l.prototype.getThreadMessagesRange=function(p,q,r,s,t,u){var v=this.$MercuryMessages18(p),w=function(ga){s(this.$MercuryMessages19(ga));}.bind(this),x=v.executeOrEnqueue(q,r,w),y=v.getUnavailableResources(x),z=this.$MercuryMessages9[p];if(y.length&&!z){var aa=v.getCurrentArraySize(),ba=this.$MercuryMessages11[p]||0,ca=aa-ba,da=y.length+ba,ea=this.getCurrentlyLoadedMessages(p),fa=ea.length?ea[0].timestamp:null;j.debug('fetch_missing_messages',JSON.stringify({threadID:p,offset:q,limit:r,timestamp:fa,missingIndices:y,messageCount:aa,localMessageCount:ba}));this.$MercuryMessages3.fetchThreadMessages(p,ca,da,fa,t,u);}else this.$MercuryMessages9[p]=false;return x;};l.prototype.getThreadMessagesRangeNow=function(p,q,r){var s=this.$MercuryMessages18(p),t=[];for(var u=q;u<q+r;u++){var v=s.getResourceAtIndex(u),w=v&&this.$MercuryMessages17(v);w&&t.push(w);}return t;};l.prototype.getThreadMessagesSinceTimestamp=function(p,q){var r=this.$MercuryMessages18(p),s=r.getElementsUntil(q);return this.$MercuryMessages19(s);};l.prototype.hasLoadedAllMessages=function(p){return this.$MercuryMessages18(p).hasReachedEndOfArray();};l.prototype.getCurrentlyLoadedMessages=function(p){var q=this.$MercuryMessages18(p).getAllResources();return this.$MercuryMessages19(q);};l.prototype.unsubscribe=function(p,q){c('MercuryAssert').isThreadID(q);var r=this.$MercuryMessages18(q);r.unsubscribe(p);};l.prototype.$MercuryMessages20=function(p,q){n(q);this.$MercuryMessages12.set(p,new (c('ImmutableObject'))(q));};l.prototype.$MercuryMessages21=function(p,q){var r=this.$MercuryMessages12.get(p);if(r){var s=r.page_admin_notes?r.page_admin_notes.slice():[],t=false,u=true;for(var v=0;v<s.length;++v)if(s[v].id===q.id){t=true;u=false;break;}else if((s[v].id===null||s[v].id===undefined)&&s[v].body===q.body){t=true;s[v]=q;}if(!t)s.push(q);if(u){var w={};w.page_admin_notes=s;this.$MercuryMessages22(p,r,w);}}};l.prototype.$MercuryMessages22=function(p,q,r){var s=c('ImmutableObject').set(q,r);this.$MercuryMessages12.set(p,s);return s;};l.prototype.$MercuryMessages23=function(p,q,r){if(p==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE){var s=this.getThreadMessagesSinceTimestamp(q,r);if(s.length>0){c('BanzaiODS').bumpEntityKey('chat.web','channel.messages_reordered');return true;}}else if(p===c('MercuryPayloadSource').SERVER_INVALIDATE_THREAD_STATE||p===c('MercuryPayloadSource').SERVER_INVALIDATE_GLOBAL_STATE)return true;return false;};l.prototype.$MercuryMessages24=function(p,q){var r=p.action_type;if(q==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE&&p.offline_threading_id&&this.$MercuryMessages13[p.offline_threading_id]===p.offline_threading_id){p.client_message_id=p.offline_threading_id;p.status=c('MercuryActionStatus').SUCCESS;p.action_type=c('MercuryActionType').SEND_MESSAGE;r=p.action_type;}if(q===c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE&&r==c('MercuryActionType').USER_GENERATED_MESSAGE){var s=this.$MercuryMessages5.getThreadMetaNow(p.thread_id);if(s&&s.folder)p.folder=s.folder;c('ChatReliabilityInstrumentation').logMESSAGE_RECEIVED();}return p;};l.prototype.handleUpdates=function(p,q,r,s){var t=void 0,u={};for(var v=0;v<p.length;v++){var w=this.$MercuryMessages24(p[v],r),x=w.action_type,y=w.message_id?this.$MercuryMessages17(w.message_id):null;if(x==c('MercuryActionType').LOG_MESSAGE)if(this.isLocalMessage(w))continue;if(w.is_forward||r==c('MercuryPayloadSource').SERVER_SEARCH){if(!this.$MercuryMessages12.has(w.message_id))this.$MercuryMessages20(w.message_id,w);continue;}else if(w.client_state===c('MercuryMessageClientState').SEND_TO_SERVER){this.$MercuryMessages20(w.message_id,w);continue;}else if(x==c('MercuryActionType').SEND_MESSAGE){var z=w.client_message_id,aa=this.$MercuryMessages17(z);if(z&&aa&&w.status){var ba=aa.status;if(aa.status==c('MercuryActionStatus').SUCCESS)continue;if(!u[w.thread_id])u[w.thread_id]=[];this.$MercuryMessages25(w);if(typeof ba!==undefined||w.status==c('MercuryActionStatus').FAILED_UNKNOWN_REASON||w.status==c('MercuryActionStatus').UNABLE_TO_CONFIRM||w.status==c('MercuryActionStatus').SUCCESS||w.status==c('MercuryActionStatus').ERROR){var ca=this.$MercuryMessages17(z);if(ca)this.$MercuryMessages26(w.thread_id,ca.message_id,r);}}continue;}else if(x==c('MercuryActionType').DELETE_THREAD){this.$MercuryMessages18(w.thread_id).removeAllResources();continue;}else if(x==c('MercuryActionType').DELETE_MESSAGES){this.$MercuryMessages27(w.thread_id,w.message_ids,r);c('setImmediate')(function(){this.$MercuryMessages6.updateSnippet(w.thread_id,w.message_ids);}.bind(this));continue;}else if(x===c('MercuryActionType').REACTION_UPDATE){if(this.$MercuryMessages28(w))this.$MercuryMessages29(u,w,r);continue;}else if(x==c('MercuryActionType').REPLACE_MESSAGE){if(this.$MercuryMessages30(w)){this.$MercuryMessages29(u,w,r);q=true;}continue;}else if(w.offline_threading_id&&this.$MercuryMessages13[w.offline_threading_id]&&(r!=c('MercuryPayloadSource').SERVER_FETCH_THREAD_INFO||this.$MercuryMessages13[w.offline_threading_id]===w.message_id)||y&&!y.is_forward){if(y&&w.ranges&&w.ranges.length>0){var da=y.message_id;this.$MercuryMessages22(this.$MercuryMessages13[da]||da,y,{ranges:w.ranges});this.$MercuryMessages26(y.thread_id,y.message_id,'link_shim');}continue;}else if(x===c('MercuryActionType').CONFIRM_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages31(w.upload_id,w.upload_data);continue;}else if(x===c('MercuryActionType').CANCEL_ATTACHMENT_PLACEHOLDER){this.$MercuryMessages32(w.upload_id,w.upload_data);continue;}else if(x==c('MercuryActionType').UNWRAP_MESSAGE){if(this.$MercuryMessages33(w))this.$MercuryMessages26(w.thread_id,w.unwrapped_message_id,r);}else{if(r===c('MercuryPayloadSource').CLIENT_SEND_MESSAGE){this.$MercuryMessages13[w.message_id]=w.message_id;if(w.thread_id=='root:'+w.offline_threading_id)this.$MercuryMessages18(w.thread_id).setReachedEndOfArray();}if(x==c('MercuryActionType').LOG_MESSAGE&&w.log_message_type==c('MercuryLogMessageType').SERVER_ERROR)this.$MercuryMessages9[w.thread_id]=true;if(w.client_state===c('MercuryMessageClientState').DO_NOT_SEND_TO_SERVER&&w.upload_id)this.$MercuryMessages14[w.upload_id]=w;if(!u[w.thread_id])u[w.thread_id]=[];u[w.thread_id].push(w.message_id);this.$MercuryMessages20(w.message_id,w);if(w.offline_threading_id&&w.offline_threading_id!=w.message_id){this.$MercuryMessages13[w.offline_threading_id]=w.message_id;c('MercuryMessageIDs').addServerID(w.offline_threading_id,w.message_id);if(w.threading_id)c('MercuryMessageIDs').addServerID(w.threading_id,w.message_id);}if(w[c('MercurySendMessageFields').MANUAL_RETRY_CNT]>0){t=this.$MercuryMessages18(w.thread_id);t.resortResources([w.message_id]);this.$MercuryMessages34(w.thread_id,c('MercuryPayloadSource').CLIENT_SEND_MESSAGE);}q=q||this.$MercuryMessages23(r,w.thread_id,w.timestamp);if(!q){var ea=this.$MercuryMessages17(w.message_id);if(ea)this.$MercuryMessages35(ea);}continue;}}for(var fa in u){t=this.$MercuryMessages18(fa);var ga=t.getAllResources(),ha=ga.filter(function(ia){var ja=this.$MercuryMessages12.get(ia);if(!ja)return true;return ja.action_type==c('MercuryActionType').LOG_MESSAGE&&ja.log_message_type==c('MercuryLogMessageType').SERVER_ERROR;}.bind(this));t.removeResources(ha);if(s)this.$MercuryMessages36(fa,u[fa]);if(q){t.addResources(u[fa]);this.$MercuryMessages34(fa,r);}else t.addResourcesWithoutSorting(u[fa].reverse(),0);this.$MercuryMessages4.updatedThread(fa);}this.$MercuryMessages8&&j.debug('handle_updates',JSON.stringify({localMessageCounts:this.$MercuryMessages11}));};l.prototype.$MercuryMessages29=function(p,q,r){if(!p[q.thread_id])p[q.thread_id]=[];this.$MercuryMessages18(q.thread_id).removeResources([q.replaced_message_id,q.offline_threading_id]);p[q.thread_id].push(q.message_id);if(q.replaced_message_id)this.$MercuryMessages26(q.thread_id,q.replaced_message_id,r);this.$MercuryMessages26(q.thread_id,q.message_id||q.messageId,r);};l.prototype.isFirstMessage=function(p){var q=this.$MercuryMessages18(p.thread_id);if(q.getCurrentArraySize()===0)return false;var r=q.getResourceAtIndex(q.getCurrentArraySize()-1),s=this.$MercuryMessages17(r),t=s&&s.message_id,u=this.$MercuryMessages17(p.message_id),v=u&&u.message_id;if(!t||!v)return false;return q.hasReachedEndOfArray()&&t==v;};l.prototype.isLocalMessage=function(p){if(p.offline_threading_id!==null&&p.offline_threading_id===p.message_id)return true;return false;};l.prototype.$MercuryMessages27=function(p,q,r){if(!q.length)return;this.$MercuryMessages37(p,q,r);if(r!==c('MercuryPayloadSource').CLIENT_CHANNEL_MESSAGE)this.$MercuryMessages3.deleteMessages(p,q);var s=this.$MercuryMessages19(q);for(var t=0;t<s.length;t++){var u=s[t];if(u&&u.has_attachment){var v=u.attachments.map(function(w){if(c('MercuryAttachment').isPhotoAttachment(w)||c('MercuryAttachment').isVideoAttachment(w))return w.metadata.fbid;return null;}).filter(function(w){return w!==null;});c('MessengerSharedMediaActions').deletePhotos(c('MercuryIDs').getThreadFBIDFromThreadID(u.thread_id),v);}}};l.prototype.$MercuryMessages37=function(p,q,r){var s=q.map(function(u){var v=this.$MercuryMessages17(u);return v&&v.message_id;}.bind(this)).filter(function(u){return !!u;}),t=this.$MercuryMessages18(p);t.removeResources(s);this.$MercuryMessages34(p,r);};l.prototype.$MercuryMessages25=function(p){var q=p.client_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s={};s.status=p.status;if(p.status===c('MercuryActionStatus').SUCCESS||p.error_data)s.error_data=p.error_data;var t=p.message_id;if(this.$MercuryMessages12.has(t)){if(r)this.$MercuryMessages22(t,r,s);return false;}if(p.threading_id)s.threading_id=p.threading_id;if(p.timestamp)s.timestamp=p.timestamp;if(p.log_message_data)s.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);s.ranges=p.ranges;}if(p.attachments&&p.attachments.length){s.raw_attachments=null;s.attachments=p.attachments;}this.$MercuryMessages13[q]=t;c('MercuryMessageIDs').addServerID(q,t);if(r){var u=this.$MercuryMessages22(t,r,s);this.$MercuryMessages12.set(q,new (c('ImmutableObject'))());if(m(u))this.$MercuryMessages11[u.thread_id]--;}return true;};l.prototype.$MercuryMessages28=function(p){var q,r=p.messageId,s=p.reaction,t=p.userId,u=this.$MercuryMessages17(r);if(!u)return false;var v=babelHelpers['extends']({},u.reactions,(q={},q[t]=s,q));this.$MercuryMessages22(r,u,{reactions:v});return true;};l.prototype.$MercuryMessages30=function(p){var q=p.replaced_message_id;if(!q)return false;var r=this.$MercuryMessages17(q);if(!r)return false;var s=p.message_id,t={};if(p.status)t.status=p.status;if(p.timestamp&&s!==q)t.timestamp=p.timestamp;if(p.log_message_data)t.log_message_data=p.log_message_data;if(p.ranges&&p.ranges.length){n(p);t.ranges=p.ranges;}if(p.attachments&&p.attachments.length){t.raw_attachments=null;t.attachments=p.attachments;}if(p.body&&p.body!==r.body)t.body=p.body;if(p.platform_xmd&&p.platform_xmd!==r.platform_xmd)t.platform_xmd=p.platform_xmd;if(p.profile_ranges&&p.profile_ranges!==r.profile_ranges)t.profile_ranges=p.profile_ranges;if(Object.keys(t).length===0)return false;c('MercuryMessageIDs').addServerID(s,s);this.$MercuryMessages22(s,r,t);if(q!==s){this.$MercuryMessages12['delete'](q);if(r.message_id&&this.$MercuryMessages12.has(r.message_id))this.$MercuryMessages12['delete'](r.message_id);}return true;};l.prototype.$MercuryMessages33=function(p){var q=this.$MercuryMessages17(p.unwrapped_message_id);if(!q||!q.tags)return false;var r=q.tags.slice(0);r.push(c('MessagingGiftWrapConstants').UNWRAPPED_TAG);var s={tags:r};this.$MercuryMessages22(p.unwrapped_message_id,q,s);return true;};l.prototype.getNumberLocalMessages=function(p){return this.$MercuryMessages11[p]||0;};l.prototype.$MercuryMessages31=function(p,q){var r=this.$MercuryMessages38(p,q);delete r.preview_attachments;this.$MercuryMessages3.sendNewMessage(r);};l.prototype.$MercuryMessages32=function(p,q){var r=this.$MercuryMessages38(p,q);this.$MercuryMessages37(r.thread_id,[r.message_id]);if(this.$MercuryMessages11[r.thread_id])this.$MercuryMessages11[r.thread_id]--;};l.prototype.$MercuryMessages38=function(p,q){var r=this.$MercuryMessages14[p];r||h(0);r.image_ids=q.image_ids;r.file_ids=q.file_ids;r.audio_ids=q.audio_ids;r.gif_ids=q.gif_ids;r.video_ids=q.video_ids;r.client_state=c('MercuryMessageClientState').SEND_TO_SERVER;delete this.$MercuryMessages14[p];return r;};l.prototype.$MercuryMessages26=function(p,q,r){this.$MercuryMessages8=true;this.$MercuryMessages4.updatedMessage(p,q,r);};l.prototype.$MercuryMessages35=function(p){this.$MercuryMessages8=true;this.$MercuryMessages4.receivedMessage(p);};l.prototype.$MercuryMessages34=function(p,q){this.$MercuryMessages8=true;this.$MercuryMessages4.reorderedMessages(p,q);};l.prototype.$MercuryMessages16=function(p){if(!this.$MercuryMessages10[p])return;var q=this.$MercuryMessages10[p].getAllResources();q.forEach(function(r){var s=this.$MercuryMessages17(r),t=undefined;if(s)t=s.offline_threading_id;this.$MercuryMessages12['delete'](r);if(t){var u=this.$MercuryMessages13[t];if(u)this.$MercuryMessages12['delete'](u);delete this.$MercuryMessages13[t];}delete this.$MercuryMessages13[r];}.bind(this));delete this.$MercuryMessages10[p];};l.addListener=function(p,q){return i.addListener(p,q);};l.prototype.$MercuryMessages17=function(p){var q=p;if(this.$MercuryMessages13[p])q=this.$MercuryMessages13[p];return this.$MercuryMessages12.get(q);};l.prototype.$MercuryMessages18=function(p){if(!this.$MercuryMessages10[p])this.$MercuryMessages10[p]=new (c('RangedCallbackManager'))(function(q){var r=this.$MercuryMessages17(q);return r&&r.timestamp;}.bind(this),function(q,r){return r-q;});return this.$MercuryMessages10[p];};l.prototype.$MercuryMessages15=function(p,q){p.forEach(function(r){var s=this.$MercuryMessages18(r);s.setReachedEndOfArray();this.$MercuryMessages34(r,q);}.bind(this));};l.prototype.$MercuryMessages19=function(p){var q=p.map(function(r){return this.$MercuryMessages17(r);}.bind(this));return q.reverse();};l.prototype.$MercuryMessages36=function(p,q){var r=q.filter(function(s){return (m(this.$MercuryMessages17(s)));}.bind(this));if(!this.$MercuryMessages11[p])this.$MercuryMessages11[p]=0;this.$MercuryMessages11[p]+=r.length;};function m(p){var q=p.action_type;if(q==c('MercuryActionType').USER_GENERATED_MESSAGE)return true;switch(p.log_message_type){case c('MercuryLogMessageType').SUBSCRIBE:case c('MercuryLogMessageType').UNSUBSCRIBE:case c('MercuryLogMessageType').SERVER_ERROR:case c('MercuryLogMessageType').LIVE_LISTEN:return false;default:return true;}}function n(p){if(!p.ranges)return;p.ranges.forEach(function(q){if(!q.entity||q.entity.external||!q.entity.url)return;var r=new (c('URI'))(q.entity.url);if(c('isMessengerDotComURI')(c('URI').getRequestURI())&&!r.getDomain()){r.setProtocol('https').setDomain('www.facebook.com');q.entity.url=r.toString();}});}var o=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercuryNotificationRenderer',['fbt','MercuryAssert','MercuryIDs','MercuryMessages','MercuryParticipants','MercuryThreads','MercuryViewer','MessagingGenericAdminTextType'],(function a(b,c,d,e,f,g,h){var i=c('MercuryMessages').get(),j=c('MercuryThreads').get();function k(l,m){c('MercuryAssert').isThreadID(l);j.getThreadMeta(l,function(n){i.getThreadMessagesRange(l,0,1,function(o){var p=o.length&&o[o.length-1];if(p.log_message_type==c('MessagingGenericAdminTextType').CONFIRM_FRIEND_REQUEST){m(h._("New contact added"));}else if(p&&p.author!=c('MercuryViewer').getID()){c('MercuryParticipants').get(p.author,function(q){var r=q.short_name;if(n.custom_nickname){var s=c('MercuryIDs').getUserIDFromParticipantID(q.id);if(n.custom_nickname[s])r=n.custom_nickname[s];}if(n.name){m(h._("{senderName} messaged {groupName}",[h.param('senderName',r),h.param('groupName',n.name)]));}else if(c('MercuryIDs').isGroupChat(l)){m(h._("{name} messaged your group",[h.param('name',r)]));}else m(h._("{name} messaged you",[h.param('name',r)]));});}else m(h._("New message!"));});});}f.exports={renderDocumentTitle:k};}),null);
__d('ChatTitleBarBlinker',['ChatActivity','DocumentTitle','JSLogger','MercuryThreadInformer','MercuryNotificationRenderer','PresenceState','MercuryTimestampTracker'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadInformer').get(),i=c('MercuryTimestampTracker').get(),j=c('JSLogger').create('chat_title'),k=null,l=0,m=false;function n(){if(k){k.stop();k=null;return true;}return false;}function o(u){var v=u||i.getLastUserMessageTimestamp();if(l<=v){l=v;if(n()||m)c('PresenceState').doSync();}}var p={blink:function u(v,w){if(!k&&l<w)c('MercuryNotificationRenderer').renderDocumentTitle(v,function(x){if(!k)k=c('DocumentTitle').blink(x);});},stopBlinking:function u(){o();},blinkingElsewhere:function u(){m=true;}};function q(u){var v=c('PresenceState').verifyNumber(u.sb2);if(!v||v<=l)return null;return v;}function r(u){var v=u&&q(u);if(v){l=v;j.debug('load',l);n();m=false;}}function s(u){var v=q(u);if(!v){j.debug('store',l);u.sb2=l;m=false;}return u;}c('PresenceState').registerStateStorer(s);c('PresenceState').registerStateLoader(r);h.subscribe('thread-read-changed',function(u,v){var w=i.getLastUserMessageTimestamp(),x=0;for(var y in v)if(v[y].mark_as_read&&v[y].timestamp>=w&&v[y].timestamp>x)x=v[y].timestamp;x&&o(x);});c('ChatActivity').subscribe('activity',function(){return o();});var t=c('PresenceState').getInitial();if(t)l=q(t)||0;f.exports=p;}),null);
__d('MercuryBlockedParticipants',['MercuryIDs','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','Set'],(function a(b,c,d,e,f,g){'use strict';h.getForFBID=function(j){return i.getForFBID(j);};h.get=function(){return i.get();};function h(j){this.$MercuryBlockedParticipants1=j;this.$MercuryBlockedParticipants2=new (c('Set'))();this.$MercuryBlockedParticipants3=c('MercuryDispatcher').getForFBID(this.$MercuryBlockedParticipants1);this.$MercuryBlockedParticipants3.subscribe('update-blocked-users',function(k,l){if(l.message_blocked_ids)this.$MercuryBlockedParticipants2=new (c('Set'))(l.message_blocked_ids);var m=l.participants||[];for(var n=m,o=Array.isArray(n),p=0,n=o?n:n[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var q;if(o){if(p>=n.length)break;q=n[p++];}else{p=n.next();if(p.done)break;q=p.value;}var r=q;if(r.is_messenger_blocked===true)this.$MercuryBlockedParticipants4(r.fbid);if(r.is_messenger_blocked===false)this.$MercuryBlockedParticipants5(r.fbid);}}.bind(this));}h.prototype.getFBID=function(){return this.$MercuryBlockedParticipants1;};h.prototype.setIDs=function(j){this.$MercuryBlockedParticipants2=j;};h.prototype.getIDs=function(){return this.$MercuryBlockedParticipants6();};h.prototype.$MercuryBlockedParticipants6=function(){return this.$MercuryBlockedParticipants2;};h.prototype.$MercuryBlockedParticipants4=function(j){this.$MercuryBlockedParticipants2.add(c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.$MercuryBlockedParticipants5=function(j){this.$MercuryBlockedParticipants2['delete'](c('MercuryIDs').getParticipantIDFromUserID(j.toString()));};h.prototype.isMessageBlocked=function(j){if(!j.is_canonical)return false;var k=j.participants.filter(function(l){return l!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this));return !k.every(function(l){return !this.$MercuryBlockedParticipants2.has(l);}.bind(this));};h.prototype.isPresentInGroupThread=function(j){if(!j.is_canonical&&this.$MercuryBlockedParticipants7(j).length>0)return true;return false;};h.prototype.inGroupThread=function(j){if(j.is_canonical)return [];return this.$MercuryBlockedParticipants7(j);};h.prototype.$MercuryBlockedParticipants7=function(j){if(!j.participants)return [];var k=j.participants.filter(function(m){return m!=c('MercuryIDs').getParticipantIDFromUserID(this.getFBID());}.bind(this)),l=k.filter(function(m){return this.$MercuryBlockedParticipants2.has(m)!==false;}.bind(this));return l;};var i=new (c('MercurySingletonProvider'))(h);f.exports=h;}),null);
__d('MercuryGroupThreadMentions',['CurrentUser','ShortProfiles'],(function a(b,c,d,e,f,g){var h={messageMentionsViewer:function i(j,k){c('ShortProfiles').get(c('CurrentUser').getID(),function(l){k(new RegExp('@'+l.firstName,'i').test(j.body));});}};f.exports=h;}),null);
__d('SoundPlayer',['URI','createArrayFromMixed'],(function a(b,c,d,e,f,g){var h=null,i={};function j(p){var q=new (c('URI'))(p);if(!q.getDomain())return new (c('URI'))(window.location.href).setPath(q.getPath()).toString();return p;}function k(p){var q=new (c('URI'))(p).getPath();if(/\.mp3$/.test(q))return 'audio/mpeg';if(/\.og[ga]$/.test(q))return 'audio/ogg';return '';}function l(){if(!h){var p=document.createElement('audio');if(!p||!p.canPlayType)return null;p.setAttribute('preload','auto');document.body.appendChild(p);h=p;}return h;}function m(p){return i[p];}function n(p,q){i[p]=q;}var o={init:function p(q){},createAndPlayNewNative:function p(q,r){var s=document.createElement('audio');s.setAttribute('preload','auto');document.body.appendChild(s);s.src=j(q);if(r){s.setAttribute('loop','');}else s.removeAttribute('loop');s.play();n(q,s);return;},play:function p(q,r){q=c('createArrayFromMixed')(q);var s=l();for(var t=0;s&&t<q.length;++t){var u=q[t],v=m(u);if(v){if(r){v.setAttribute('loop','');}else v.removeAttribute('loop');v.play();return;}var w=k(u);if(!s.canPlayType(w))continue;o.createAndPlayNewNative(u,r);return;}},stop:function p(q){q=c('createArrayFromMixed')(q);for(var r=0;r<q.length;++r){var s=j(q[r]),t=m(q[r]);if(t&&t.src==s){t.pause();t.removeAttribute('src');t.src=s;}}}};f.exports=o;}),null);
__d('SoundSynchronizer',['SoundPlayer','WebStorage','createArrayFromMixed'],(function a(b,c,d,e,f,g){var h='fb_sounds_playing3';function i(){var m=c('WebStorage').getLocalStorage();if(m)try{var o=m[h];if(o){o=JSON.parse(o);if(Array.isArray(o))return o;}}catch(n){}return [];}function j(m){var n=c('WebStorage').getLocalStorage();if(n){var o=i();o.push(m);while(o.length>5)o.shift();try{n[h]=JSON.stringify(o);}catch(p){}}}function k(m){return i().some(function(n){return n===m;});}var l={play:function m(n,o,p){n=c('createArrayFromMixed')(n);o=o||n[0]+Math.floor(Date.now()/1000);if(k(o))return;c('SoundPlayer').play(n,p);j(o);},isSupported:function m(){return !!c('WebStorage').getLocalStorage();}};f.exports=l;}),null);
__d('SoundRPC',['Event','FBJSON','SoundSynchronizer'],(function a(b,c,d,e,f,g){function h(j,k,l){c('SoundSynchronizer').play(j,k,l);}var i={playLocal:h,playRemote:function j(k,l,m,n){var o={name:'SoundRPC',data:{paths:l,sync:m,loop:n}};k.postMessage(c('FBJSON').stringify(o),'*');},supportsRPC:function j(){return !!window.postMessage;},_listen:function j(){c('Event').listen(window,'message',function(k){if(!/\.facebook.com$/.test(k.origin))return;var l={};try{l=c('FBJSON').parse(k.data);}catch(m){}if(l.name==='SoundRPC')h(l.data.paths,l.data.sync,l.data.loop);});}};f.exports=i;}),null);
__d('Sound',['SoundInitialData','SoundPlayer','SoundRPC','SoundSynchronizer','URI','UserAgent_DEPRECATED','Visibility','isFacebookURI'],(function a(b,c,d,e,f,g){var h=null,i=false,j={init:function n(o){},play:function n(o,p,q){if(h){c('SoundRPC').playRemote(h.contentWindow,o,p,false);}else c('SoundRPC').playLocal(o,p,q);i=true;},hasPlayedSoundBefore:function n(){return i;},playOnlyIfImmediate:function n(o,p,q){if(!i&&c('Visibility').isHidden())return;this.play(o,p,q);},stop:function n(o){if(!h)c('SoundPlayer').stop(o);}},k=new (c('URI'))(location.href);if(k.getSubdomain()&&k.getSubdomain()!=='www')k.setSubdomain('www');var l=k.getDomain();function m(){if(c('UserAgent_DEPRECATED').ie()<9)return false;if(c('SoundInitialData').RPC_DISABLED)return false;return c('SoundSynchronizer').isSupported()&&c('SoundRPC').supportsRPC();}if(c('isFacebookURI')(k)&&location.host!==l&&m()){h=document.createElement('iframe');h.setAttribute('src','//'+l+'/sound_iframe.php');h.style.display='none';document.body.appendChild(h);}f.exports=j;}),null);
__d('MercuryBrowserAlerts',['ArbiterMixin','ChatActivity','ChatConfig','ChatOptions','ChatTitleBarBlinker','Event','Map','MercuryBlockedParticipants','MercuryConfig','MercuryGroupThreadMentions','MercuryThreadInfo','MercuryThreads','MercuryViewer','MessagingTag','Sound','UserActivity'],(function a(b,c,d,e,f,g){var h=c('MercuryBlockedParticipants').get(),i=c('MercuryThreads').get(),j=3,k=600000,l=new (c('Map'))(),m=0;function n(){return !c('UserActivity').isOnTab()&&!c('UserActivity').hasBeenInactive();}function o(){l=new (c('Map'))();}function p(r){if(c('ChatOptions').getSetting('sound')&&!n())c('Sound').play([c('ChatConfig').get('sound.notif_ogg_url'),c('ChatConfig').get('sound.notif_mp3_url')],r,false);}var q=Object.assign({init:function r(){c('Event').listen(window,'focus',function(){o();clearInterval(m);});c('Event').listen(window,'blur',function(){m=setInterval(o,k);});},messageReceived:function r(s){if(s.author&&c('MercuryViewer').isViewer(s.author)||!s.is_unread||s.folder!=c('MessagingTag').INBOX&&s.folder!=c('MessagingTag').ARCHIVED)return;var t=s.thread_id,u=c('ChatActivity').isActive();if(u){var v=false;q.inform('before-alert',{threadID:t,cancelAlert:function w(){v=true;}});}i.getThreadMeta(t,function(w){var x=c('MercuryThreadInfo').isMuted(w);c('MercuryGroupThreadMentions').messageMentionsViewer(s,function(y){if(x&&(!c('MercuryConfig').GroupChatMentionsGK||!y))return;if(h.isPresentInGroupThread(w))return;var z=s.timestamp;if(u){!v&&p(z);}else{c('ChatTitleBarBlinker').blink(t,z);var aa=l.get(t)||0;if(aa<j){l.set(t,aa+1);p(z);}}c('ChatTitleBarBlinker').blinkingElsewhere();});});}},c('ArbiterMixin'));f.exports=q;}),null);
__d('MessengerDispatcher',['Dispatcher_DEPRECATED'],(function a(b,c,d,e,f,g){'use strict';f.exports=new (c('Dispatcher_DEPRECATED'))();}),null);
__d('MercuryFilters',['MessagingTag','arrayContains'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').UNREAD],i={ALL:'all',NONPRIORITY:'non-priority',UNREAD:c('MessagingTag').UNREAD,getSupportedFilters:function j(){return h.concat();},isSupportedFilter:function j(k){return c('arrayContains')(h,k);}};f.exports=i;}),null);
__d('MessengerStateProcessor',['MercuryAPIArgsSource','MercuryIDs','MercuryParticipantTypes','MercuryParticipants','MercuryThreadIDMap','MercuryThreads','MercuryVanityIDMap','MessengerURIConstants'],(function a(b,c,d,e,f,g){'use strict';var h={preprocess:function j(k){var l=k.activeThreadID;if(l){var m=c('MercuryIDs').getUserIDFromThreadID(l),n=m&&c('MercuryParticipants').getNow(c('MercuryIDs').getParticipantIDFromUserID(m));if(n&&n.type!==c('MercuryParticipantTypes').EVENT){k.threadKey=n.vanity||m;}else if(m&&!n){var o=c('MercuryIDs').getParticipantIDFromUserID(m);k.threadKey=c('MercuryVanityIDMap').hasID(o)?c('MercuryVanityIDMap').getVanity(o):m;}else{var p=c('MercuryThreadIDMap').get(),q=p.getServerIDFromClientIDNow(l);k.threadKey=q||c('MercuryIDs').tokenize(l).value;}}delete k.activeThreadID;return k;},postprocess:function j(k){var l=c('MercuryThreadIDMap').get(),m=c('MercuryThreads').get(),n=i(k.threadKey),o=void 0;o=c('MercuryIDs').isValid(n)?n:l.getClientIDFromServerIDNow(n);if(!o){var p=c('MercuryParticipants').getIDFromVanityOrFBID(n),q=p&&m.getCanonicalThreadToParticipant(p,null,c('MercuryAPIArgsSource').MESSENGER);if(q)o=q.thread_id;}if(o){k.activeThreadID=o;k.serverThreadID=l.getServerIDFromClientIDNow(o);}delete k.threadKey;return k;},supportInboxPostprocess:function j(k){if(k.threadKey)k.activeThreadID=c('MercuryIDs').getThreadIDFromSupportInboxItemID(k.threadKey);delete k.threadKey;return k;}};function i(j){if(!j)return null;return j.startsWith(c('MessengerURIConstants').GROUP_PREFIX)?j.substr(c('MessengerURIConstants').GROUP_PREFIX.length):j;}f.exports=h;}),null);
__d('MessengerURISerializer',['CurrentEnvironment','MercuryFilters','MessagingTag','MessengerStateProcessor','MessengerURIConstants','MessengerView','URI','WWWBase'],(function a(b,c,d,e,f,g){'use strict';var h='/?$',i=function m(n,o){n.setPath(c('CurrentEnvironment').facebookdotcom?c('MessengerURIConstants').FACEBOOK_PREFIX+o:o);},j=function m(n,o){var p=n.getPath();if(c('CurrentEnvironment').facebookdotcom&&!p.startsWith(c('MessengerURIConstants').FACEBOOK_PREFIX))o=c('MessengerURIConstants').FACEBOOK_PREFIX+o;n.setPath(n.getPath()+o);},k={serialize:function m(n){var o=new (c('URI'))(c('WWWBase').uri);n=c('MessengerStateProcessor').preprocess(n);switch(n.masterView){case c('MessengerView').MASTER.GROUPS:i(o,c('MessengerURIConstants').GROUPS_PATH);break;case c('MessengerView').MASTER.PEOPLE:i(o,c('MessengerURIConstants').PEOPLE_PATH);break;case c('MessengerView').MASTER.SUPPORT:i(o,c('MessengerURIConstants').SUPPORT_PATH);break;}switch(n.folder){case c('MessagingTag').OTHER:i(o,c('MessengerURIConstants').FILTERED_REQUESTS_PATH);break;case c('MessagingTag').ACTION_ARCHIVED:i(o,c('MessengerURIConstants').ARCHIVED_PATH);break;case c('MessagingTag').PENDING:i(o,c('MessengerURIConstants').MESSAGE_REQUESTS_PATH);break;}if(n.detailView===c('MessengerView').DETAIL.COMPOSE){j(o,c('MessengerURIConstants').COMPOSE_SUBPATH);}else if(n.threadKey){j(o,c('MessengerURIConstants').THREAD_PREFIX+n.threadKey);}else j(o,'');if(n.extraQueryParms)o.addQueryData(n.extraQueryParams);if(c('MercuryFilters').isSupportedFilter(n.filter))o.addQueryData({filter:n.filter});if(n.query!=null){var p;o.addQueryData((p={},p[n.masterView===c('MessengerView').MASTER.SEARCH?'qa':'q']=n.query,p));}if(n.mid)o.addQueryData({mid:n.mid});return o;},deserialize:function m(n){var o={},p=n.getPath();if(c('CurrentEnvironment').facebookdotcom&&!p.startsWith(c('MessengerURIConstants').FACEBOOK_PREFIX))o.notMessenger=true;var q=p.replace(c('MessengerURIConstants').FACEBOOK_PREFIX,''),r=n.getQueryData(),s=r.filter,t=r.mid,u=r.q,v=r.qa,w=babelHelpers.objectWithoutProperties(r,['filter','mid','q','qa']);if(q.match('^'+c('MessengerURIConstants').GROUPS_PATH)){o.masterView=c('MessengerView').MASTER.GROUPS;}else if(q.match('^'+c('MessengerURIConstants').PEOPLE_PATH)){o.masterView=c('MessengerView').MASTER.PEOPLE;}else if(q.match('^'+c('MessengerURIConstants').SUPPORT_PATH)){o.masterView=c('MessengerView').MASTER.SUPPORT;}else if(v){o.masterView=c('MessengerView').MASTER.SEARCH;}else o.masterView=c('MessengerView').MASTER.RECENT;if(q.match('^'+c('MessengerURIConstants').FILTERED_REQUESTS_PATH)){o.folder=c('MessagingTag').OTHER;}else if(q.match('^'+c('MessengerURIConstants').ARCHIVED_PATH)){o.folder=c('MessagingTag').ACTION_ARCHIVED;}else if(q.match('^'+c('MessengerURIConstants').MESSAGE_REQUESTS_PATH)){o.folder=c('MessagingTag').PENDING;}else o.folder=c('MessagingTag').INBOX;if(q.match(c('MessengerURIConstants').COMPOSE_SUBPATH+h)){o.detailView=c('MessengerView').DETAIL.COMPOSE;}else{var x=l(q);if(x){o.threadKey=x;o.detailView=c('MessengerView').DETAIL.THREAD;}}if(c('MercuryFilters').isSupportedFilter(s)){o.filter=s;}else o.filter=c('MercuryFilters').ALL;o.mid=t;o.query=v||u;o.extraQueryParams=w;if(o.masterView===c('MessengerView').MASTER.SUPPORT)return c('MessengerStateProcessor').supportInboxPostprocess(o);return c('MessengerStateProcessor').postprocess(o);}};function l(m){var n=m.match(c('MessengerURIConstants').THREAD_PREFIX+'([^/]+)'+h);return n&&n[1];}f.exports=k;}),null);
__d('MessengerActions',['invariant','MercuryIDs','MessengerDispatcher','MessengerURISerializer','MercuryTypeaheadConstants','MessengerView','URI','goURI','keyMirror'],(function a(b,c,d,e,f,g,h){'use strict';var i=c('keyMirror')({HIDE_DIALOG:null,REPLACE_STATE:null,SHOW_DIALOG:null,UPDATE_MDOT_ME:null}),j={Types:i,changeDetailView:function l(m){k(function(n){if(n.detailView!==m)return {detailView:m};});},changeMasterView:function l(m){k(function(n){if(n.masterView!==m){var o={masterView:m};if(n.masterView===c('MessengerView').MASTER.SEARCH)o.query=undefined;return o;}});},selectThread:function l(m,n){if(n===c('MercuryTypeaheadConstants').MEETING_ROOM_PAGE_TYPE){!!m||h(0);var o=c('MercuryIDs').getUserIDFromThreadID(m);!!o||h(0);var p=new (c('URI'))(),q=p.getQualifiedURI().getSubdomain();p.setDomain('facebook.com').setSubdomain(q).setPath('/'+o).setProtocol('https');window.open(p,'_blank');return;}k(function(r){if(r.activeThreadID!==m)return {activeThreadID:m,detailView:c('MessengerView').DETAIL.THREAD,mid:null};});},changeState:function l(m){c('MessengerDispatcher').dispatch({type:i.REPLACE_STATE,nextState:m});},showDialog:function l(m,n){c('MessengerDispatcher').dispatch({type:j.Types.SHOW_DIALOG,dialogClass:m,dialogProps:n});},changeMDotMeReferral:function l(){var m=arguments.length<=0||arguments[0]===undefined?null:arguments[0],n=arguments.length<=1||arguments[1]===undefined?null:arguments[1];c('MessengerDispatcher').dispatch({type:j.Types.UPDATE_MDOT_ME,refCode:m,refThreadID:n});},hideDialog:function l(m){c('MessengerDispatcher').dispatch({type:j.Types.HIDE_DIALOG,dialogClass:m});},changeFolder:function l(m){k(function(n){if(n.folder!==m)return {folder:m};});},changeFilter:function l(m){k(function(n){if(n.filter!==m)return {filter:m};});},changeQuery:function l(m){k(function(n){if(n.query!==m)return {query:m};});},changeQueryAll:function l(m){var n=!!m;k(function(o){if(o.queryAll!==m)return {query:m,masterView:c('MessengerView').MASTER.SEARCH};});},changeMid:function l(m){k(function(n){if(n.mid!==m)return {mid:m};});}};function k(l){var m=c('MessengerURISerializer').deserialize(new (c('URI'))(window.location.href)),n=l(m);if(n)c('goURI')(c('MessengerURISerializer').serialize(Object.assign(m,n)));}f.exports=j;}),null);
__d('MNCommerceActionTypes',['keyMirrorRecursive'],(function a(b,c,d,e,f,g){'use strict';var h=c('keyMirrorRecursive')({RECEIPT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},SHIPMENT:{LOADED:null,LOAD_ERROR:null,RELOAD:null},DIALOG:{SHOW:null,HIDE:null},RETAIL_ITEM:{LOADED:null,LOAD_ERROR:null,RELOAD:null},PROMOTION_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},TRANSACTION_INVOICE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},BOT_REVIEW_STATE:{LOADED:null,LOAD_ERROR:null,RELOAD:null},BOTS_MENU:{SHOW:null,HIDE:null,LOADED:null,VISIBILITY_LOADED:null,LOAD_ERROR:null,RELOAD:null}});f.exports=h;}),null);
__d('MessengerSpinner.react',['cx','fbt','ix','Image.react','React','joinClasses'],(function a(b,c,d,e,f,g,h,i,j){'use strict';var k,l,m=c('React').PropTypes,n=j('/images/mercury/clients/messenger/core/LoadingSpinner.png'),o=j('/images/mercury/clients/messenger/core/LoadingSpinnerGrey.png'),p=j('/images/mercury/clients/messenger/core/LoadingSpinnerExtraLarge.png'),q=24,r=32;k=babelHelpers.inherits(s,c('React').PureComponent);l=k&&k.prototype;s.prototype.render=function(){return (c('React').createElement(c('Image.react'),{'aria-label':i._("Loading..."),'aria-busy':true,className:c('joinClasses')(this.props.className,"_3u55 _3qh2"),height:this.props.size,src:this.$MessengerSpinner1(),width:this.props.size}));};s.prototype.$MessengerSpinner1=function(){return this.props.size===q?this.props.color==='blue'?n:o:p;};function s(){k.apply(this,arguments);}s.propTypes={color:m.oneOf(['blue','grey']),size:m.oneOf([q,r])};s.defaultProps={color:'blue',size:q};s.Sizes={LARGE:r,MEDIUM:q};f.exports=s;}),null);
__d('MNCommerceDialogStateStore',['FluxStore','MessengerDispatcher','MNCommerceActionTypes'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('FluxStore'));i=h&&h.prototype;function j(){i.constructor.call(this,c('MessengerDispatcher'));this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;}j.prototype.__onDispatch=function(k){var l=k.type;switch(l){case c('MNCommerceActionTypes').DIALOG.SHOW:this.$MNCommerceDialogStateStore1=k.dialogContainer;this.$MNCommerceDialogStateStore2=k.state;this.__emitChange();break;case c('MNCommerceActionTypes').DIALOG.HIDE:this.$MNCommerceDialogStateStore1=null;this.$MNCommerceDialogStateStore2=null;this.__emitChange();break;}};j.prototype.getDialogContainer=function(){return this.$MNCommerceDialogStateStore1;};j.prototype.getState=function(){return this.$MNCommerceDialogStateStore2;};f.exports=new j();}),null);
__d('FBRTCMessageHandler',['invariant','Bootloader','FBRTCMessageListener','FBRTCSupport'],(function a(b,c,d,e,f,g,h){var i=null,j=false,k=null,l={init:function o(){if(!j&&c('FBRTCSupport').isReceiveWebrtcSupported()){j=true;c('FBRTCMessageListener').init(false);c('FBRTCMessageListener').once('messageReceived',function(p){m();});c('FBRTCMessageListener').once('multiwayMessageReceived',function(p){n(p);});}},resetListener:function o(){i||h(0);c('FBRTCMessageListener').removeMessageHandler();c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);}};function m(){if(!i)c('Bootloader').loadModules(["FBRTCIncomingCallController","FBRTCIncomingCallDialog","FBRTCMissedVideoCallHandler","FBRTCUnsupportedBrowserMessage"],function(o,p,q,r){i=new o(p,r,new q());c('FBRTCMessageListener').setMessageHandler(i.onMessageReceived,i);},'FBRTCMessageHandler');}function n(o){if(!k)c('Bootloader').loadModules(["FBRTCGroupCallIncomingController","FBRTCGroupCallIncomingDialog"],function(p,q){k=new p(q);c('FBRTCMessageListener').setMultiwayMessageHandler(k.onMessageReceived,k);k.onMessageReceived(o);},'FBRTCMessageHandler');}f.exports=l;}),null);
__d('HotLikeSound',['MercurySoundsConfig','SoundPlayer','StickerConstants'],(function a(b,c,d,e,f,g){'use strict';var h=[c('MercurySoundsConfig').hot_like_grow_mp3_url,c('MercurySoundsConfig').hot_like_grow_ogg_url],i=[c('MercurySoundsConfig').hot_like_pop_mp3_url,c('MercurySoundsConfig').hot_like_pop_ogg_url],j=[c('MercurySoundsConfig').hot_like_outgoing_small_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_small_ogg_url],k=[c('MercurySoundsConfig').hot_like_outgoing_medium_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_medium_ogg_url],l=[c('MercurySoundsConfig').hot_like_outgoing_large_mp3_url,c('MercurySoundsConfig').hot_like_outgoing_large_ogg_url],m=function o(){return false;},n={setCheckSoundEnabledFunc:function o(p){m=p;},start:function o(){this._play(h);},stop:function o(){c('SoundPlayer').stop(h);},pop:function o(){this.stop();this._play(i);},snap:function o(p){this.stop();if(p===c('StickerConstants').HOT_LIKE_SMALL_STICKER_ID)this._play(j);if(p===c('StickerConstants').HOT_LIKE_MEDIUM_STICKER_ID)this._play(k);if(p===c('StickerConstants').HOT_LIKE_LARGE_STICKER_ID)this._play(l);},_play:function o(p){if(m())c('SoundPlayer').play(p);}};f.exports=n;}),null);
__d('MercuryTypeaheadDataSource',['CurrentUser','DataSource','MercuryConfig','MercuryParticipantTypes','MercuryTypeaheadConstants','OrderedFriendsList','ShortProfiles','WorkModeConfig','debounce'],(function a(b,c,d,e,f,g){var h,i,j=500,k=[],l={},m={},n={},o=false,p=false;h=babelHelpers.inherits(q,c('DataSource'));i=h&&h.prototype;function q(r){'use strict';r=r||{};r.kanaNormalization=true;i.constructor.call(this,r);}q.prototype.dirty=function(){'use strict';this.$MercuryTypeaheadDataSource1=k;this.localCache=m;this.queryCache=l;this.queryIDs=n;return this;};q.prototype.bootstrap=function(){'use strict';if(o||p)return false;p=true;c('ShortProfiles').fetchAll().then(function(){this.updateBootstrapData();p=false;o=true;}.bind(this),function(){}.bind(this));return true;};q.prototype.updateBootstrapData=function(){'use strict';var r=this.getCachedShortProfileIDs(),s=c('WorkModeConfig').is_work_user?c('MercuryParticipantTypes').FB4C:c('MercuryParticipantTypes').FRIEND,t=r.map(function(u){var v=c('ShortProfiles').getNow(u),w=u==c('CurrentUser').getID()?s:v.type,x=[v.additionalName,v.alternateName].concat(v.searchTokens||[]).join(' '),y=v.name,z=null;return {uid:u,index:c('OrderedFriendsList').getActiveRank(u),text:y,subtext:z,tokens:x,localized_text:v.name,additional_text:v.additionalName,photo:v.thumbSrc,render_type:w,type:c('MercuryTypeaheadConstants').USER_TYPE};});if(t.length)this.addEntries(t);};q.prototype.query=function(r,s,t,u){'use strict';var v=s||r.length===1;return i.query.call(this,r,v,t,u);};q.prototype.getQueryData=function(r,s){'use strict';return babelHelpers['extends']({},i.getQueryData.call(this,r,s));};q.prototype.setEntry=function(r,s){'use strict';this.$MercuryTypeaheadDataSource1[r]=s;};q.prototype.getEntry=function(r){'use strict';return this.$MercuryTypeaheadDataSource1[r]||null;};q.prototype.getCachedShortProfileIDs=function(){'use strict';var r=c('ShortProfiles').getCachedProfileIDs(),s=r.filter(function(t){var u=c('ShortProfiles').getNow(t);return (t==c('CurrentUser').getID()||u.type===c('MercuryParticipantTypes').FRIEND||u.type===c('MercuryParticipantTypes').FB4C||u.type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(t.toString())>-1);});return s;};q.prototype.isBootstrapped=function(){'use strict';return o;};q.prototype.isBootstrapping=function(){'use strict';return p;};q.prototype.processEntries=function(r,s){'use strict';r=r.map(function(t){if(t.index==null&&(t.render_type===c('MercuryParticipantTypes').FRIEND||t.render_type===c('MercuryParticipantTypes').FB4C))t.index=c('OrderedFriendsList').getActiveRank(t.uid);if(t.render_type===c('MercuryParticipantTypes').PAGE&&c('MercuryConfig').LinkedAgents&&c('MercuryConfig').LinkedAgents.indexOf(t.uid.toString())>-1)t.index=1;return t;});return i.processEntries.call(this,r);};q.prototype.mergeUids=function(r,s,t,u){'use strict';var v=s.sort(function(w,x){return this.getEntry(w).index-this.getEntry(x).index;}.bind(this));return i.mergeUids.call(this,r,v,t,u);};f.exports=q;}),null);
__d('MercuryRoger',['Arbiter','ArbiterMixin','immutable','JSLogger','MercuryActionStatus','MercuryDispatcher','MercurySingletonProvider','MercuryThreads','mixin','mapObject'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=c('MercuryActionStatus').SUCCESS;h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(o){return l.getForFBID(o);};k.get=function(){return l.get();};function k(o){i.constructor.call(this);this.$MercuryRoger1={};this.$MercuryRoger2=[];this.$MercuryRoger3=o;this.$MercuryRoger4=c('MercuryDispatcher').getForFBID(this.$MercuryRoger3);this.$MercuryRoger5=c('MercuryThreads').getForFBID(this.$MercuryRoger3);this.$MercuryRoger4.subscribe('update-roger',function(p,q){for(var r in q){var s=this.$MercuryRoger1[r]||c('immutable').OrderedMap();s=s.withMutations(function(t){for(var u in q[r]){var v=this.$MercuryRoger5.getThreadMetaNow(r);if(v&&v.participants)if(v.participants.indexOf(u)==-1){this.$MercuryRoger2.push(n(this.$MercuryRoger1));continue;}var w=t.get(u),x=q[r][u];if(!w||x.watermark>w.watermark)t.set(u,x);}}.bind(this));this.$MercuryRoger1[r]=s.sort(function(t,u){return t.watermark-u.watermark;});}q&&this.inform('change',q);}.bind(this));this.$MercuryRoger4.subscribe('invalidate-global-state',function(){this.$MercuryRoger6();}.bind(this));c('Arbiter').subscribe(c('JSLogger').DUMP_EVENT,function(p,q){var r={};for(var s in this.$MercuryRoger1)if(this.$MercuryRoger1.hasOwnProperty(s))r[s]=this.$MercuryRoger1[s].toObject();q.read_receipts={valid_receipts:r,bad_receipts:this.$MercuryRoger2};}.bind(this));}k.prototype.getSeenBy=function(o,p){if(!o)return [];var q=[],r=this.$MercuryRoger1[o.thread_id];if(!r)return q;r.forEach(function(s,t){if(m(o,s.watermark,t,p))q.push(t);});return q;};k.prototype.wasSeenByAll=function(o){if(!o)return false;var p=this.$MercuryRoger1[o.thread_id];if(!p)return false;return p.every(function(q,r){return m(o,q.watermark,r);});};k.prototype.getSeenTimestamps=function(o){var p=this.$MercuryRoger1[o];if(!p){p=c('immutable').OrderedMap();this.$MercuryRoger1[o]=p;}return p;};k.prototype.getSeenTimestamp=function(o,p){var q=this.$MercuryRoger1[o];return q?q.get(p):null;};k.prototype.$MercuryRoger6=function(){this.$MercuryRoger1={};this.$MercuryRoger2=[];};var l=new (c('MercurySingletonProvider'))(k);function m(o,p,q,r){return !!(p>=o.timestamp&&(o.status===undefined||o.status===j)&&(!r||q!=o.author));}function n(o){return c('mapObject')(o,function(p){return p.toJS();});}f.exports=k;}),null);
__d('MercuryDelayedRoger',['ArbiterMixin','LiveTimer','MercuryActionStatus','MercuryConfig','MercuryMessages','MercuryRoger','MercurySingletonProvider','MercuryThreadInformer','MercuryThreads','mixin','setTimeoutAcrossTransitions'],(function a(b,c,d,e,f,g){var h,i,j=c('MercuryConfig')['roger.seen_delay'];h=babelHelpers.inherits(k,c('mixin')(c('ArbiterMixin')));i=h&&h.prototype;k.getForFBID=function(m){'use strict';return l.getForFBID(m);};k.get=function(){'use strict';return l.get();};function k(m){'use strict';i.constructor.call(this);this.$MercuryDelayedRoger9=function(event,n){var o={};for(var p in n)if(this.$MercuryDelayedRoger11(p))o[p]=true;Object.keys(o).forEach(function(q){return this.$MercuryDelayedRoger12(o);}.bind(this));}.bind(this);this.$MercuryDelayedRoger1=m;this.$MercuryDelayedRoger2=c('MercuryRoger').getForFBID(m);this.$MercuryDelayedRoger4={};this.$MercuryDelayedRoger5={};this.$MercuryDelayedRoger2.subscribe('change',function(n,o){for(var p in o)!this.$MercuryDelayedRoger5[p]&&this.$MercuryDelayedRoger8(p);}.bind(this));this.$MercuryDelayedRoger3=c('MercuryThreadInformer').getForFBID(m);this.$MercuryDelayedRoger6=c('MercuryMessages').getForFBID(m);this.$MercuryDelayedRoger7=c('MercuryThreads').getForFBID(m);this.$MercuryDelayedRoger3.subscribe('messages-received',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-reordered',this.$MercuryDelayedRoger9);this.$MercuryDelayedRoger3.subscribe('messages-updated',this.$MercuryDelayedRoger9);}k.prototype.getSeenBy=function(m,n){'use strict';if(this.$MercuryDelayedRoger5[m])return [];return this.$MercuryDelayedRoger2.getSeenBy(this.$MercuryDelayedRoger10(m),n);};k.prototype.wasSeenByAll=function(m){'use strict';if(this.$MercuryDelayedRoger5[m])return false;return this.$MercuryDelayedRoger2.wasSeenByAll(this.$MercuryDelayedRoger10(m));};k.prototype.$MercuryDelayedRoger10=function(m){'use strict';if(!this.$MercuryDelayedRoger4[m]){var n=this.$MercuryDelayedRoger7.getThreadMetaNow(m);if(n)this.$MercuryDelayedRoger4[m]={thread_id:m,author:n.participants[0],timestamp:n.timestamp};}return this.$MercuryDelayedRoger4[m];};k.prototype.$MercuryDelayedRoger11=function(m){'use strict';var n=false;this.$MercuryDelayedRoger6.getThreadMessagesRange(m,0,1,function(o){var p=o[0];if(!p)return;var q=p.timestamp;if(p.status===c('MercuryActionStatus').SUCCESS)q-=c('LiveTimer').getServerTimeOffset();var r=this.getSeenBy(m);if(this.$MercuryDelayedRoger5[m]){clearTimeout(this.$MercuryDelayedRoger5[m]);delete this.$MercuryDelayedRoger5[m];}var s=q+j,t=s-Date.now();if(t>0)this.$MercuryDelayedRoger5[m]=c('setTimeoutAcrossTransitions')(function(){delete this.$MercuryDelayedRoger5[m];this.$MercuryDelayedRoger8(m);}.bind(this),t);this.$MercuryDelayedRoger4[m]=p;var u=this.getSeenBy(m);if(r.length||u.length)n=true;}.bind(this));return n;};k.prototype.$MercuryDelayedRoger8=function(m){'use strict';var n={};n[m]=true;this.$MercuryDelayedRoger12(n);};k.prototype.$MercuryDelayedRoger12=function(m){'use strict';this.inform('state-changed',m);this.inform('change');};var l=new (c('MercurySingletonProvider'))(k);f.exports=k;}),null);
__d('MercuryDeliveryState',['MercuryConfig','MercuryIDs','MercuryServerRequests','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInformer','PresencePrivacy','UserActivity','debounceAcrossTransitions'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryConfig').delivery_timeout||120000;i.getForFBID=function(k){return j.getForFBID(k);};i.get=function(){return j.get();};function i(k){this.$MercuryDeliveryState1=k;this.$MercuryDeliveryState2=c('MercuryServerRequests').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState3=c('MercuryThreadInformer').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState4=c('MercuryThreadIDMap').getForFBID(this.$MercuryDeliveryState1);this.$MercuryDeliveryState5=[];this.$MercuryDeliveryState6={};this.$MercuryDeliveryState3.subscribe('messages-received',this.$MercuryDeliveryState7.bind(this));c('UserActivity').subscribe(c('debounceAcrossTransitions')(this.$MercuryDeliveryState8,300,this));}i.prototype.$MercuryDeliveryState7=function(k,l){for(var m in l){var n=l[m];n.forEach(function(o){if(this.$MercuryDeliveryState9(o)){this.$MercuryDeliveryState5.push(o);this.$MercuryDeliveryState4.getServerIDFromClientID(m,function(p){if(!this.$MercuryDeliveryState6[p])this.$MercuryDeliveryState6[p]=[];this.$MercuryDeliveryState6[p].push(o.message_id);}.bind(this));}}.bind(this));}if(c('UserActivity').isActive(h))this.$MercuryDeliveryState8();};i.prototype.$MercuryDeliveryState8=function(){if(this.$MercuryDeliveryState5.length===0&&Object.keys(this.$MercuryDeliveryState6).length===0)return;var k=this.$MercuryDeliveryState5.map(function(l){return l.message_id;});if(k)this.$MercuryDeliveryState2.sendDeliveryReceipts(k,this.$MercuryDeliveryState6);this.$MercuryDeliveryState6={};this.$MercuryDeliveryState5=[];};i.prototype.$MercuryDeliveryState9=function(k){var l=k.author?c('MercuryIDs').getUserIDFromParticipantID(k.author):null;if(l===this.$MercuryDeliveryState1)return false;if(!k.is_unread)return false;if(!c('PresencePrivacy').allows(l))return false;return true;};var j=new (c('MercurySingletonProvider'))(i);f.exports=i;}),null);
__d('MercuryFolders',['MercuryFoldersConfig','MessagingTag'],(function a(b,c,d,e,f,g){var h=[c('MessagingTag').INBOX,c('MessagingTag').PENDING,c('MessagingTag').OTHER,c('MessagingTag').ACTION_ARCHIVED],i={getSupportedFolders:function j(){return h.filter(function(k){if(k===c('MessagingTag').PENDING){return !c('MercuryFoldersConfig').hide_message_filtered;}else if(k===c('MessagingTag').OTHER)return !c('MercuryFoldersConfig').hide_message_requests;return true;}).concat();},getFromMeta:function j(k){var l=k.folder;if(k.is_archived)l=c('MessagingTag').ACTION_ARCHIVED;return l;}};f.exports=i;}),null);
__d('MercuryUnreadState',['invariant','MercuryFolders','LogHistory','KeyedCallbackManager','MercuryActionType','MercuryDispatcher','MercuryGlobalActionType','MercurySingletonProvider','MercuryThreadlistConstants','MercuryThreadIDMap','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','arrayContains','createObjectFrom'],(function a(b,c,d,e,f,g,h){'use strict';var i=(c('MercuryFolders').getSupportedFolders()||[]).filter(function(p){return p!==c('MessagingTag').ACTION_ARCHIVED;}),j='unread_thread_hash',k='unseen_thread_list',l=c('MercuryThreadlistConstants').MAX_UNREAD_COUNT,m=c('LogHistory').getInstance('mercury_unread_state');n.getForFBID=function(p){return o.getForFBID(p);};n.get=function(){return o.get();};function n(p){this.$MercuryUnreadState1=p;this.$MercuryUnreadState2=c('MercuryServerRequests').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState3=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState4=c('MercuryThreadInformer').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState5=c('MercuryThreads').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState6=c('MercuryDispatcher').getForFBID(this.$MercuryUnreadState1);this.$MercuryUnreadState7={};this.$MercuryUnreadState8={};this.$MercuryUnreadState9={};this.$MercuryUnreadState10={};this.$MercuryUnreadState11={};i.forEach(function(q){this.$MercuryUnreadState9[q]=0;this.$MercuryUnreadState10[q]=false;this.$MercuryUnreadState11[q]=new (c('KeyedCallbackManager'))();}.bind(this));this.$MercuryUnreadState6.subscribe('update-unread',this.$MercuryUnreadState12.bind(this));this.$MercuryUnreadState6.subscribe('update-thread-ids',function(q,r){this.$MercuryUnreadState13(r);}.bind(this));}n.prototype.getUnreadCount=function(p){if(this.exceedsMaxCount(p)){m.error('unguarded_unread_count_fetch','{}');return 0;}return this.$MercuryUnreadState14(p);};n.prototype.exceedsMaxCount=function(p){return this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>l;};n.prototype.markFolderAsRead=function(p){if(this.$MercuryUnreadState10[p]||this.$MercuryUnreadState14(p)>0)this.$MercuryUnreadState2.markFolderAsRead(p);};n.prototype.getIsThreadUnread=function(p,q){var r=q||c('MessagingTag').INBOX,s=this.$MercuryUnreadState15(r);return !!(s&&s[p]);};n.prototype.$MercuryUnreadState12=function(p,q){this.$MercuryUnreadState16(q);var r=q.global_actions||[];for(var s=0;s<r.length;s++){var t=r[s];if(t.action_type==c('MercuryGlobalActionType').MARK_ALL_READ)this.$MercuryUnreadState17(t.folder,t.timestamp);}};n.prototype.$MercuryUnreadState18=function(p,q){this.$MercuryUnreadState11[p].setResource(j,q);this.$MercuryUnreadState11[p].setResource(k,Object.keys(q));};n.prototype.$MercuryUnreadState19=function(p,q){var r=this.$MercuryUnreadState11[p].executeOrEnqueue(j,q),s=this.$MercuryUnreadState11[p].getUnavailableResources(r);if(s.length)this.$MercuryUnreadState2.fetchUnreadThreadIDs(p);};n.prototype.$MercuryUnreadState15=function(p){return this.$MercuryUnreadState11[p].getResource(j);};n.prototype.$MercuryUnreadState14=function(p){var q=this.$MercuryUnreadState11[p].getResource(k);if(q){return q.length;}else return this.$MercuryUnreadState9[p];};n.prototype.$MercuryUnreadState16=function(p){var q=void 0;(p.unread_thread_fbids||[]).forEach(function(r){q=r.folder;if(!this.$MercuryUnreadState20(q))return;var s=r.thread_fbids||[];s=s.concat(r.other_user_fbids||[]);var t=this.$MercuryUnreadState21(s);this.$MercuryUnreadState18(q,c('createObjectFrom')(t,true));if(t.length>l)this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState4.updatedUnreadState();}.bind(this));(p.message_counts||[]).forEach(function(r){if(r.unread_count===undefined)return;q=r.folder;if(r.unread_count>l){this.$MercuryUnreadState10[q]=true;this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}else{this.$MercuryUnreadState9[q]=r.unread_count;if(this.$MercuryUnreadState9[q]===0)this.$MercuryUnreadState18(q,{});this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));(p.actions||[]).forEach(function(r){if(r.is_forward)return;var s=c('MercuryActionType'),t=r.other_user_fbid?r.other_user_fbid:r.thread_fbid,u=r.thread_id?r.thread_id:t;if(r.action_type==s.DELETE_THREAD){i.forEach(function(w){this.$MercuryUnreadState22(w,u);}.bind(this));}else if(r.action_type==s.CHANGE_ARCHIVED_STATUS||r.action_type==s.CHANGE_FOLDER){var v=this.$MercuryUnreadState5.getThreadMetaNow(r.thread_id);!!v||h(0);q=c('MercuryFolders').getFromMeta(v);if(this.$MercuryUnreadState20(q)&&v.unread_count>0)this.$MercuryUnreadState23(q,u);i.forEach(function(w){if(w!=q)this.$MercuryUnreadState22(w,u);}.bind(this));}else{q=this.$MercuryUnreadState24(r);if(!this.$MercuryUnreadState20(q))return;if(r.action_type==s.CHANGE_READ_STATUS){if(r.mark_as_read){this.$MercuryUnreadState22(q,u,r.timestamp);}else this.$MercuryUnreadState23(q,u,r.timestamp);}else if(r.action_type==s.USER_GENERATED_MESSAGE||r.action_type==s.LOG_MESSAGE)if(r.is_unread)this.$MercuryUnreadState23(q,u,r.timestamp);}}.bind(this));};n.prototype.$MercuryUnreadState23=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){var t=this.$MercuryUnreadState7[p]||0,u=this.$MercuryUnreadState8[q]||0,v=r||Number.POSITIVE_INFINITY;if(v>=t&&v>=u&&!s[q]){s[q]=r||0;this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState22=function(p,q,r){if(this.$MercuryUnreadState10[p])return;this.$MercuryUnreadState19(p,function(s){if(r){var t=this.$MercuryUnreadState8[q];if(!t||t<r)this.$MercuryUnreadState8[q]=r;}var u=s[q];if(r&&typeof u=='number'&&r<u)return;if(q in s){delete s[q];this.$MercuryUnreadState18(p,s);this.$MercuryUnreadState4.updatedUnreadState();}}.bind(this));};n.prototype.$MercuryUnreadState17=function(p,q){this.$MercuryUnreadState10[p]=false;this.$MercuryUnreadState18(p,{});this.$MercuryUnreadState7[p]=Math.max(this.$MercuryUnreadState7[p]||0,q||0);this.$MercuryUnreadState4.updatedUnreadState();};n.prototype.$MercuryUnreadState21=function(p){return p.map(this.$MercuryUnreadState3.convertThreadIDIfAvailable,this.$MercuryUnreadState3);};n.prototype.$MercuryUnreadState13=function(p){i.forEach(function(q){var r=this.$MercuryUnreadState15(q);if(!r)return;for(var s in p){var t=p[s];if(r[s]){r[t]=r[s];delete r[s];}}this.$MercuryUnreadState18(q,r);}.bind(this));};n.prototype.$MercuryUnreadState24=function(p){var q=p.thread_id?this.$MercuryUnreadState5.getThreadMetaNow(p.thread_id):null;return q?c('MercuryFolders').getFromMeta(q):p.folder?p.folder:'';};n.prototype.$MercuryUnreadState20=function(p){return c('arrayContains')(i,p);};var o=new (c('MercurySingletonProvider'))(n);f.exports=n;}),null);
__d('MercuryUnseenState',['MercuryFolders','KeyedCallbackManager','LogHistory','MercuryActionType','MercuryDispatcher','MercurySingletonProvider','MercuryThreadIDMap','MercuryThreadInfo','MercuryThreadlistConstants','MessagingTag','MercuryServerRequests','MercuryThreadInformer','MercuryThreads','createObjectFrom','isEmpty'],(function a(b,c,d,e,f,g){'use strict';var h=c('MercuryThreadlistConstants').MAX_UNSEEN_COUNT,i='unseen_thread_hash',j='unseen_thread_list',k=c('LogHistory').getInstance('mercury_unseen_state');l.getForFBID=function(n){return m.getForFBID(n);};l.get=function(){return m.get();};function l(n){this.$MercuryUnseenState2=n;this.$MercuryUnseenState7=c('MercuryServerRequests').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState8=c('MercuryThreadIDMap').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState10=c('MercuryThreads').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState9=c('MercuryThreadInformer').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState1=c('MercuryDispatcher').getForFBID(this.$MercuryUnseenState2);this.$MercuryUnseenState3=0;this.$MercuryUnseenState4=0;this.$MercuryUnseenState5=false;this.$MercuryUnseenState6=false;this.$MercuryUnseenState11=new (c('KeyedCallbackManager'))();this.$MercuryUnseenState1.subscribe('update-unseen',function(o,p){this.$MercuryUnseenState12(p);}.bind(this));this.$MercuryUnseenState1.subscribe('update-thread-ids',function(o,p){this.$MercuryUnseenState13(p);}.bind(this));}l.prototype.getUnseenCount=function(){if(this.exceedsMaxCount()){k.error('unguarded_unseen_count_fetch','{}');return 0;}return this.$MercuryUnseenState14();};l.prototype.exceedsMaxCount=function(){return this.$MercuryUnseenState5||this.$MercuryUnseenState14()>h;};l.prototype.markAsSeen=function(){var n=this.$MercuryUnseenState14();if(n===null){this.$MercuryUnseenState6=true;}else if(n>0||this.$MercuryUnseenState5){this.$MercuryUnseenState7.markSeen();this.$MercuryUnseenState15(this.$MercuryUnseenState7.getLastActionTimestamp(),[]);}};l.prototype.$MercuryUnseenState16=function(n,o){var p;this.$MercuryUnseenState17((p={},p[n]=0,p),o);};l.prototype.$MercuryUnseenState18=function(n){this.$MercuryUnseenState11.setResource(i,n);this.$MercuryUnseenState11.setResource(j,Object.keys(n));};l.prototype.$MercuryUnseenState19=function(n){var o=this.$MercuryUnseenState11.executeOrEnqueue(i,n),p=this.$MercuryUnseenState11.getUnavailableResources(o);if(p.length)this.$MercuryUnseenState7.fetchUnseenThreadIDs();};l.prototype.$MercuryUnseenState20=function(){return this.$MercuryUnseenState11.getResource(i);};l.prototype.$MercuryUnseenState14=function(){var n=this.$MercuryUnseenState11.getResource(j);if(n){return n.length;}else return this.$MercuryUnseenState3;};l.prototype.$MercuryUnseenState12=function(n){var o,p=this,q=this.$MercuryUnseenState21(n);if(n.unseen_thread_fbids){n.unseen_thread_fbids.forEach(function(r){if(r.folder!=c('MessagingTag').INBOX)return;var s=(r.thread_fbids||[]).concat(r.other_user_fbids||[]),t=this.$MercuryUnseenState22(s),u=q.seen_timestamp?q.seen_timestamp:this.$MercuryUnseenState4;this.$MercuryUnseenState15(u,t);if(q.unseen_count>h)this.$MercuryUnseenState5=true;}.bind(this));}else if(q.seen_timestamp!==undefined){this.$MercuryUnseenState4=q.seen_timestamp;if(q.unseen_count>h){this.$MercuryUnseenState5=true;this.$MercuryUnseenState18({});}else{this.$MercuryUnseenState3=q.unseen_count;if(this.$MercuryUnseenState3===0)this.$MercuryUnseenState18({});}}else{var o=function(){var r;if(p.$MercuryUnseenState5)return {v:void 0};var s=n.actions;if(!s||!s.length)return {v:void 0};var t={},u={},v=function x(y){var z=s[y];if(z.is_forward)return 'continue';var aa=z.action_type,ba=z.other_user_fbid?z.other_user_fbid:z.thread_fbid,ca=z.thread_id?z.thread_id:ba;if(aa===c('MercuryActionType').MARK_THREAD_SEEN){p.$MercuryUnseenState16(ca,z.persistent);return 'continue';}if(!p.$MercuryUnseenState23(z))return 'continue';if(aa===c('MercuryActionType').USER_GENERATED_MESSAGE||aa===c('MercuryActionType').LOG_MESSAGE){var da=t[ca]?z.timestamp>t[ca]:false,ea=da||!t[ca];if(z.is_unread&&ea)p.$MercuryUnseenState10.getThreadMeta(ca,function(fa){var ga=false;if(fa&&fa.last_read_timestamp)if(fa.last_read_timestamp>=z.timestamp)ga=true;if(!c('MercuryThreadInfo').isMuted(fa)&&!ga)t[ca]=z.timestamp;});}else if(aa===c('MercuryActionType').CHANGE_READ_STATUS&&z.mark_as_read)u[ca]=z.timestamp;};for(var w=0;w<s.length;w++){var r=v(w);if(r==='continue')continue;}p.$MercuryUnseenState24(t);p.$MercuryUnseenState17(u);}();if(typeof o==="object")return o.v;}if(this.$MercuryUnseenState6){this.$MercuryUnseenState6=false;this.markAsSeen();}};l.prototype.$MercuryUnseenState15=function(n,o){var p=this.$MercuryUnseenState20();if(p===undefined||n>this.$MercuryUnseenState4||this.$MercuryUnseenState5){this.$MercuryUnseenState4=n;o=o||[];if(o.length<=h)this.$MercuryUnseenState5=false;var q={},r=this.$MercuryUnseenState20();for(var s in r)if(r[s]!==true){var t=r[s];if(this.$MercuryUnseenState25(t))q[s]=t;}var u=Object.assign(c('createObjectFrom')(o,true),q);this.$MercuryUnseenState18(u);this.$MercuryUnseenState9.updatedUnseenState();}};l.prototype.$MercuryUnseenState24=function(n){if(this.$MercuryUnseenState5)return;var o={},p=false;for(var q in n){var r=n[q];if(this.$MercuryUnseenState25(r)){o[q]=r;p=true;}}if(!p)return;this.$MercuryUnseenState19(function(s){for(var t in o){var u=o[t];if(!s[t]&&this.$MercuryUnseenState25(u))s[t]=o[t];}this.$MercuryUnseenState18(s);this.$MercuryUnseenState9.updatedUnseenState();}.bind(this));};l.prototype.$MercuryUnseenState17=function(n,o){if(!c('isEmpty')(n))this.$MercuryUnseenState19(function(p){var q=false;for(var r in n){var s=n[r],t=s>=p[r];if(p[r]&&(!s||t)){delete p[r];q=true;}}if(q){this.$MercuryUnseenState18(p);this.$MercuryUnseenState9.updatedUnseenState();if(o&&this.$MercuryUnseenState14()===0)this.$MercuryUnseenState7.markSeen();}}.bind(this));};l.prototype.$MercuryUnseenState25=function(n){return n>this.$MercuryUnseenState4;};l.prototype.$MercuryUnseenState22=function(n){return n.map(this.$MercuryUnseenState8.convertThreadIDIfAvailable,this.$MercuryUnseenState8);};l.prototype.$MercuryUnseenState13=function(n){var o=this.$MercuryUnseenState20();if(!o)return;for(var p in n){var q=n[p];if(o[p]){o[q]=o[p];delete o[p];}}this.$MercuryUnseenState18(o);};l.prototype.$MercuryUnseenState23=function(n){var o=n.thread_id?this.$MercuryUnseenState10.getThreadMetaNow(n.thread_id):null,p=o?c('MercuryFolders').getFromMeta(o):n.folder;return p===c('MessagingTag').INBOX||p===undefined;};l.prototype.$MercuryUnseenState21=function(n){var o=n.message_counts||[];for(var p=0;p<o.length;p++)if(o[p].folder===c('MessagingTag').INBOX)return o[p];return {};};var m=new (c('MercurySingletonProvider'))(l);f.exports=l;}),null);
__d('MercurySyncConstants',[],(function a(b,c,d,e,f,g){'use strict';var h={ARBITER_EVENT_INVALID_STATE:'SYNC:INVALID_STATE',ARBITER_EVENT_INVALID_STATE_RETRY:'SYNC:INVALID_STATE_RETRY',ARBITER_EVENT_INVALID_STATE_RECOVER:'SYNC:INVALID_STATE_RECOVER'};f.exports=h;}),null);
__d('NotificationJewelReminderLoader',['JSResource'],(function a(b,c,d,e,f,g){f.exports={init:function h(i){c('JSResource')('NotificationJewelReminder').__setRef('NotificationJewelReminderLoader').load().done(function(j){new j(i);});}};}),null);
__d('P2PActionConstants',[],(function a(b,c,d,e,f,g){'use strict';var h={CREDIT_CARDS_UPDATED:'credit_cards_updated',CREDIT_CARDS_UPDATED_ERROR:'credit_cards_updated_error',CHANNEL_EVENTS_ALLOWED:'channel_events_allowed',CHANNEL_EVENTS_IGNORED:'channel_events_ignored',CREDIT_CARD_SAVING:'credit_card_saving',CREDIT_CARD_ADDED:'credit_card_added',CREDIT_CARD_ADDED_ERROR:'credit_card_added_error',CREDIT_CARD_ADDED_ERROR_CLEARED:'credit_card_added_error_cleared',CREDIT_CARD_DELETED:'credit_card_deleted',CREDIT_CARD_DELETED_ERROR:'credit_card_deleted_error',CREDIT_CARD_UPDATED:'credit_card_updated',CREDIT_CARD_UPDATED_ERROR:'credit_card_updated_error',PRESET_CREDIT_CARD_UPDATED:'preset_credit_card_updated',PRESET_CREDIT_CARD_UPDATED_ERROR:'preset_credit_card_updated_error',CREDIT_CARD_VERIFIED:'credit_card_verified',CREDIT_CARD_VERIFIED_ERROR:'credit_card_verified_error',PAYMENT_METHODS_UPDATED:'payment_methods_updated',PAYMENT_METHODS_UPDATED_ERROR:'payment_methods_updated_error',TRANSFERS_UPDATED:'transfers_updated',TRANSFERS_UPDATED_ERROR:'transfers_updated_error',NUX_TRANSFERS_UPDATED:'nux_transfers_updated',TRANSFER_ADDED:'transfer_added',TRANSFER_ADDED_ERROR:'transfer_added_error',TRANSFER_UPDATED:'transfer_updated',TRANSFER_UPDATED_ERROR:'transfer_updated_error',TRANSFER_ACCEPTED:'transfer_accepted',TRANSFER_DECLINED:'transfer_declined',CHAT_SEND_VIEW_OPENED:'chat_send_view_opened',CHAT_SEND_VIEW_CLOSED:'chat_send_view_closed',BIN_NUMBER_VALIDATED:'bin_number_validated',BIN_NUMBER_VALIDATED_ERROR:'bin_number_validated_error',USER_ELIGIBILITY_UDPATED:'user_eligibility_updated',FRIENDS_LIST_UPDATED:'friends_list_updated',DIALOG_SHOWN:'dialog_shown',DIALOG_CLOSED:'dialog_closed',BANNER_STATES_UPDATED:'banner_states_updated',BANNER_DISMISSED:'banner_dismissed',BANNER_VIEWED:'banner_viewed',BANNER_COMPLETED:'banner_completed',MONEYPENNY_TRANSFER_CREATED:'moneypenny_transfer_created',MONEYPENNY_TRANSFER_CREATED_ERROR:'moneypenny_transfer_created_error',PLATFORM_CONTEXT_ADDED:'platform_context_added',PLATFORM_CONTEXT_ADDED_ERROR:'platform_context_added_error',PLATFORM_CONTEXT_SAVE_ERRORS_CLEARED:'platform_context_save_errors_cleared',PLATFORM_CONTEXT_BANNER_DISMISSED:'platform_context_banner_dismissed',PLATFORM_CONTEXT_PRODUCT_ITEM_SOLD:'platform_context_product_item_sold',PLATFORM_CONTEXT_CHANGED:'platform_context_changed',EXTENSIVE_TRANSFER_DETAILS_UPDATED:'extensive_transfer_details_updated',ADDRESS_SAVING:'address_saving',ADDRESSES_UPDATED:'addresses_updated',ADDRESS_ADDED:'address_added',ADDRESS_ADDED_ERROR:'address_added_error',ADDRESS_ADDED_ERROR_CLEARED:'address_added_error_cleared',CHECKOUT_CART_INITIATED:'checkout_cart_initiated',CHECKOUT_CART_CREATED:'checkout_cart_created',CHECKOUT_SHIPPING_OPTION_SELECTED:'checkout_shipping_option_selected',CHECKOUT_ADDRESS_SELECTED:'checkout_address_selected',CHECKOUT_CREDIT_CARD_SELECTED:'checkout_credit_card_selected',CHECKOUT_ADDRESS_FORM_TOGGLED:'checkout_address_form_toggled',CHECKOUT_CREDIT_CARD_FORM_TOGGLED:'checkout_credit_card_form_toggled',CHECKOUT_ADDRESS_EDIT_OPTIONS_TOGGLED:'checkout_address_options_toggled',CHECKOUT_CREDIT_CARD_EDIT_OPTIONS_TOGGLED:'checkout_credit_card_edit_options_toggled',CHECKOUT_PAYMENT_METHOD_EDIT_OPTIONS_TOGGLED:'checkout_payment_edit_options_toggled',CHECKOUT_PAYMENT_METHOD_SELECTED:'checkout_payment_method_selected',CHECKOUT_PAYMENT_METHOD_CONFIGURED:'checkout_payment_method_configured',CHECKOUT_PAYMENT_METHOD_CONFIRMED:'checkout_payment_method_confirmed',CHECKOUT_ADDRESS_FORM_VALIDATED:'checkout_address_form_validated',CHECKOUT_CREDIT_CARD_FORM_VALIDATED:'checkout_credit_card_form_validated',CHECKOUT_EDIT_COMPLETED:'checkout_completed',CHECKOUT_PROCESSING:'checkout_processing',CHECKOUT_BUYER_PROFILE_UPDATED:'checkout_buyer_profile_updated',CHECKOUT_MANUAL_PAYMENT_RECEIPT_UPDATED:'checkout_manual_payment_receipt_updated',PAYMENT_REQUEST_INITIATED:'payment_request_initiated',PAYMENT_REQUEST_INITIATED_COMPLETE:'payment_request_initiated_completed',PAYMENT_REQUEST_CREATED:'payment_request_created',PAYMENT_REQUEST_CREATED_ERROR:'payment_request_created_error',PAYMENT_REQUEST_UPDATED:'payment_request_updated',PAYMENT_REQUEST_DECLINE_INITIATED:'payment_request_decline_initiated',PAYMENT_REQUEST_DECLINED:'payment_request_declined',PAYMENT_REQUEST_DECLINE_ERROR:'payment_request_decline_error',PAYMENT_REQUESTS_FETCHED:'payment_requests_fetched',PAYMENT_REQUEST_CANCEL_INITIATED:'payment_request_cancel_initiated',PAYMENT_REQUEST_CANCELED:'payment_request_canceled',PAYMENT_REQUEST_CANCEL_ERROR:'payment_request_cancel_error'};f.exports=h;}),null);
__d('P2PDispatcher',['ExplicitRegistrationReactDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i;h=babelHelpers.inherits(j,c('ExplicitRegistrationReactDispatcher'));i=h&&h.prototype;function j(k){i.constructor.call(this,k);this.dispatch=this.dispatch.bind(this);}f.exports=new j({strict:false});}),null);
__d('P2PSendMoneyDialogStore',['P2PActionConstants','EventEmitter','Map','P2PDispatcher'],(function a(b,c,d,e,f,g){'use strict';var h,i,j=void 0,k=void 0;h=babelHelpers.inherits(l,c('EventEmitter'));i=h&&h.prototype;function l(){i.constructor.call(this);k=new (c('Map'))();j=c('P2PDispatcher').register(this.onEventDispatched.bind(this));}l.prototype.onEventDispatched=function(m){var n=m.data,o=m.type;switch(o){case c('P2PActionConstants').CHAT_SEND_VIEW_OPENED:this.handleChatSendViewOpened(n);this.emit('change');break;case c('P2PActionConstants').CHAT_SEND_VIEW_CLOSED:this.handleChatSendViewClosed(n);this.emit('change');break;}};l.prototype.getStateByThreadID=function(m){return k.get(m);};l.prototype.handleChatSendViewOpened=function(m){k.set(m.threadID,{amount:m.amount,groupSendRecipientUserID:m.groupSendRecipientUserID,groupSendReceiptDetails:m.groupSendReceiptDetails,groupThreadFBID:m.groupThreadFBID,onCompletion:m.onCompletion,openRequestTab:m.openRequestTab,memoText:m.memoText,platformData:m.platformData,referrer:m.referrer,paymentRequestID:m.paymentRequestID,sendMoneyDialogShown:true,sendMoneyNUXDismissed:m.sendMoneyNUXDismissed,useModal:m.useModal});};l.prototype.handleChatSendViewClosed=function(m){k.set(m.threadID,{amount:'',groupSendRecipientUserID:null,groupSendReceiptDetails:null,groupThreadFBID:'',onCompletion:null,openRequestTab:false,memoText:null,platformData:null,referrer:null,paymentRequestID:null,sendMoneyDialogShown:false,sendMoneyNUXDismissed:false,useModal:false});};l.prototype.isAnyChatSendViewOpen=function(){for(var m=k.values(),n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==='function'?Symbol.iterator:'@@iterator']();;){var p;if(n){if(o>=m.length)break;p=m[o++];}else{o=m.next();if(o.done)break;p=o.value;}var q=p;if(q.sendMoneyDialogShown)return true;}return false;};f.exports=new l();}),null);
__d('WorkDualityDismissWarning',[],(function a(b,c,d,e,f,g){'use strict';var h={},i={};f.exports={isWarningAcknowledged:function j(k){if(h[k])return true;return false;},acknowledgeWarning:function j(k){h[k]=true;},isThreadHijacked:function j(k){if(i[k])return true;return false;},setHijackedThread:function j(k){i[k]=true;}};}),null);
__d('isInFocusMode',['WorkFocusModeController'],(function a(b,c,d,e,f,g){var h=c('WorkFocusModeController').WorkFocusMode,i=function j(k){return !!(h&&h.currentViewerInFocusMode(k));};f.exports=i;}),null);
__d('PureStoreBasedStateMixin',['invariant','StoreBasedStateMixinHelper','setImmediate'],(function a(b,c,d,e,f,g,h){'use strict';var i=function(){for(var j=arguments.length,k=Array(j),l=0;l<j;l++)k[l]=arguments[l];return {getInitialState:function m(){return this.constructor.calculateState();},componentWillMount:function m(){this.constructor.calculateState||h(0);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new (c('StoreBasedStateMixinHelper'))(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=c('setImmediate')(n);}.bind(this));},componentWillUnmount:function m(){this._mixin.release();this._mixin=null;}};}.bind(this);f.exports=i;}),null);
__d('idx',[],(function a(b,c,d,e,f,g){'use strict';function h(n,o){try{return o(n);}catch(p){if(p instanceof TypeError)if(j(p)){return null;}else if(l(p))return undefined;throw p;}}var i=void 0;function j(n){var o=n.message;if(!i)i=m(null);return i.test(o);}var k=void 0;function l(n){var o=n.message;if(!k)k=m(undefined);return k.test(o);}var m=new Function('$object$','\n  try {\n    $object$.$property$;\n  } catch (error) {\n    return new RegExp(\n      error.message\n        .replace(/[-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \'\\\\$&\')\n        .replace(\'\\\\$object\\\\$\', \'.+\')\n        .replace(\'\\\\$property\\\\$\', \'.+\')\n    );\n  }\n  throw new Error(\'Expected property access on \' + $object$ + \' to throw.\');\n');f.exports=h;}),null);